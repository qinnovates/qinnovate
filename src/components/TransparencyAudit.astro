---
interface Props {
  className?: string;
  audit?: {
    decisionsLogged: number;
    independentReviews: number;
    humanDecisionRate: string;
    verificationPasses: number;
    automatedTests: number;
  };
}

const { className, audit } = Astro.props;

// Use provided audit data or fallback to defaults
const auditData = audit || {
  decisionsLogged: 0,
  independentReviews: 0,
  humanDecisionRate: "0%",
  verificationPasses: 0,
  automatedTests: 0,
};

const lastBuild = new Date().toISOString().split('T')[0];
---

<div class:list={["glass rounded-2xl p-6 border border-[var(--color-border)] relative overflow-hidden", className]}>
  <div class="flex items-center justify-between mb-6">
    <div class="flex items-center gap-2">
      <div class="w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse"></div>
      <h2 class="text-sm font-bold uppercase tracking-widest text-[var(--color-text-faint)]">Live Audit Data</h2>
    </div>
    <div class="text-[10px] uppercase font-bold text-[var(--color-text-faint)] bg-black/5 px-2 py-1 rounded">
      Ref: QIF-6.1-AUDIT
    </div>
  </div>

  <div class="grid grid-cols-2 sm:grid-cols-3 gap-6">
    <div>
      <div class="text-xs text-[var(--color-text-faint)] mb-1 uppercase font-semibold">Decisions Logged</div>
      <div class="text-2xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-accent-primary)]">
        {auditData.decisionsLogged}
      </div>
    </div>
    <div>
      <div class="text-xs text-[var(--color-text-faint)] mb-1 uppercase font-semibold">Independent Reviews</div>
      <div class="text-2xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-accent-secondary)]">
        {auditData.independentReviews}
      </div>
    </div>
    <div>
      <div class="text-xs text-[var(--color-text-faint)] mb-1 uppercase font-semibold">Human Decision Rate</div>
      <div class="text-2xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-status-safe)]">
        {auditData.humanDecisionRate}
      </div>
    </div>
    <div class="opacity-80">
      <div class="text-xs text-[var(--color-text-faint)] mb-1 uppercase font-semibold">Research Sources</div>
      <div class="text-xl font-bold font-[family-name:var(--font-heading)]">
        {auditData.verificationPasses}
      </div>
    </div>
    <div class="opacity-80">
      <div class="text-xs text-[var(--color-text-faint)] mb-1 uppercase font-semibold">Unit Tests</div>
      <div class="text-xl font-bold font-[family-name:var(--font-heading)]">
        {auditData.automatedTests}
      </div>
    </div>
    <div class="opacity-80">
      <div class="text-xs text-[var(--color-text-faint)] mb-1 uppercase font-semibold">Last Verified</div>
      <div class="text-xl font-bold font-[family-name:var(--font-heading)]">
        {lastBuild}
      </div>
    </div>
  </div>

  <div class="mt-6 pt-6 border-t border-[var(--color-border)] flex items-center justify-between">
    <div class="text-[10px] text-[var(--color-text-muted)] italic">
      Self-documenting auditable record. All metrics synced with `QIF-DERIVATION-LOG.md`.
    </div>
    <a 
      href="https://github.com/qinnovates/qinnovate/blob/main/governance/TRANSPARENCY.md" 
      target="_blank"
      class="text-[10px] font-bold uppercase tracking-tighter text-[var(--color-accent-primary)] hover:text-[var(--color-accent-secondary)] transition-colors flex items-center gap-1"
    >
      View on GitHub
      <svg class="w-2.5 h-2.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
      </svg>
    </a>
  </div>
</div>
