---
import PageLayout from '../layouts/PageLayout.astro';
import { COHERENCE, SCALE_FREQUENCY } from '../lib/qif-constants';
import BrainVisualization from '../components/brain/BrainVisualization';
import { getBrainViewData } from '../lib/brain-view-data';
import {
  ETHICS_VERSION, ETHICS_STATUS, ETHICS_DATE, ETHICS_AUTHOR, ETHICS_LICENSE, ETHICS_LICENSE_URL,
  PREAMBLE, CANONS, PRINCIPLES, CROSS_REFERENCES,
  INTRO_TEXT, FRAMEWORKS_TEXT, FRAMEWORK_LINKS,
} from '../data/code-of-ethics';

const brainViews = getBrainViewData();
---

<PageLayout
  title="Security — Qinnovate"
  description="How QIF protects neural interfaces — signal coherence authentication, frequency-band defense mapping, and the security architecture behind the hourglass model."
  breadcrumbs={[{ label: 'Security' }]}
>
  <div class="mb-12">
    <h1 class="text-3xl sm:text-4xl font-bold font-[family-name:var(--font-heading)] mb-4">Security</h1>
    <p class="text-lg text-[var(--color-text-muted)] max-w-3xl">
      QIF's security architecture protects neural interfaces across three domains: real-time signal authentication, layered frequency-band defense, and threat-mapped scoring. These are the mechanisms that determine whether a neural signal is legitimate or tampered with.
    </p>
  </div>

  <!-- Brain Visualization -->
  <section class="mb-16">
    <BrainVisualization client:only="react" views={brainViews} defaultView="security" />
  </section>

  <!-- How It All Fits Together -->
  <section class="mb-16">
    <h2 class="text-2xl font-semibold font-[family-name:var(--font-heading)] mb-2">How It All Fits Together</h2>
    <p class="text-[var(--color-text-muted)] mb-8 max-w-3xl">
      QIF's security isn't a single tool — it's a pipeline. Each layer feeds the next, from threat discovery through scoring, wire-level protection, and secure content delivery.
    </p>

    <!-- Pipeline visualization -->
    <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
      <div class="glass rounded-xl p-6 border-t-4" style="border-color: #ef4444;">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-2xl">1</span>
          <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)]">Map</h3>
        </div>
        <p class="text-sm text-[var(--color-text-muted)] mb-3">
          <a href="/TARA/" class="text-[var(--color-accent-secondary)] hover:underline font-medium">TARA Atlas</a> catalogs 103+ attack techniques across 8 categories — signal injection, eavesdropping, cognitive manipulation, and more. Every technique is mapped to the brain regions it targets.
        </p>
        <span class="text-xs font-[family-name:var(--font-mono)] text-[var(--color-text-faint)]">What can go wrong?</span>
      </div>

      <div class="glass rounded-xl p-6 border-t-4" style="border-color: #f97316;">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-2xl">2</span>
          <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)]">Score</h3>
        </div>
        <p class="text-sm text-[var(--color-text-muted)] mb-3">
          <a href="/scoring/" class="text-[var(--color-accent-secondary)] hover:underline font-medium">NISS</a> scores each technique on 5 neural-specific dimensions — brain impact, cognitive gravity, controllability, reversibility, and neural propagation. Not CVSS for servers — NISS for brains.
        </p>
        <span class="text-xs font-[family-name:var(--font-mono)] text-[var(--color-text-faint)]">How bad is it?</span>
      </div>

      <div class="glass rounded-xl p-6 border-t-4" style="border-color: #eab308;">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-2xl">3</span>
          <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)]">Protect</h3>
        </div>
        <p class="text-sm text-[var(--color-text-muted)] mb-3">
          <a href="/nsp/" class="text-[var(--color-accent-secondary)] hover:underline font-medium">NSP</a> secures the wire. Post-quantum cryptography at the I0 interface — the single point every neural signal must cross. Hybrid key exchange, coherence-gated authentication, and tiered defense by device class.
        </p>
        <span class="text-xs font-[family-name:var(--font-mono)] text-[var(--color-text-faint)]">How do we stop it?</span>
      </div>

      <div class="glass rounded-xl p-6 border-t-4" style="border-color: #3b82f6;">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-2xl">4</span>
          <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)]">Deliver</h3>
        </div>
        <p class="text-sm text-[var(--color-text-muted)] mb-3">
          <a href="/runemate/" class="text-[var(--color-accent-secondary)] hover:underline font-medium">Project Runemate</a> compiles multimodal content (images, sound, touch) into Staves bytecode — 65-90% smaller than classical web formats. PQ-encrypted end-to-end through NSP. Small enough for implanted chips, secure enough for brain signals.
        </p>
        <span class="text-xs font-[family-name:var(--font-mono)] text-[var(--color-text-faint)]">How do we deliver safely?</span>
      </div>
    </div>

    <div class="glass rounded-lg p-6 max-w-3xl">
      <p class="text-sm text-[var(--color-text-muted)]">
        <strong class="text-[var(--color-text)]">The pipeline in one sentence:</strong> TARA maps every known attack on the brain, NISS scores how dangerous each one is, NSP locks down the wire with post-quantum cryptography, and Runemate delivers content through that secure channel small enough to run on implanted hardware. Each layer is independent but designed to work together — the coherence metric (<span class="font-[family-name:var(--font-mono)] text-[var(--color-accent-secondary)]">C<sub>s</sub></span>) above is the same signal that NSP uses to gate authentication in real time.
      </p>
    </div>
  </section>

  <!-- Signal Authentication -->
  <section class="mb-16">
    <h2 class="text-2xl font-semibold font-[family-name:var(--font-heading)] mb-2">Signal Authentication</h2>
    <p class="text-[var(--color-text-muted)] mb-8 max-w-3xl">
      The coherence metric <span class="font-[family-name:var(--font-mono)] text-[var(--color-accent-secondary)]">C<sub>s</sub></span> measures whether a neural signal is authentic by evaluating three variance dimensions. When coherence drops below threshold, the system flags or rejects the signal — the same way a spam filter catches forged emails, but for brain signals.
    </p>

    <div class="grid lg:grid-cols-2 gap-8">
      <!-- Coherence Calculator -->
      <div class="glass rounded-xl p-8" id="coherence-calc">
        <h3 class="text-xl font-semibold font-[family-name:var(--font-heading)] mb-2">Coherence Calculator</h3>
        <p class="text-sm text-[var(--color-text-muted)] mb-6">
          Adjust variance parameters to compute the coherence metric in real time. Higher variance means more signal degradation.
        </p>

        <div class="space-y-6">
          <!-- Phase variance slider -->
          <div>
            <div class="flex justify-between text-sm mb-2">
              <label for="sigma-phi" class="text-[var(--color-text-muted)]">Phase variance (&sigma;&sup2;&psi;)</label>
              <span id="sigma-phi-val" class="font-[family-name:var(--font-mono)] text-[var(--color-accent-secondary)]">0.10</span>
            </div>
            <input type="range" id="sigma-phi" min="0" max="2" step="0.01" value="0.10" class="w-full accent-[var(--color-accent-secondary)]" />
          </div>

          <!-- Temporal variance slider -->
          <div>
            <div class="flex justify-between text-sm mb-2">
              <label for="sigma-tau" class="text-[var(--color-text-muted)]">Temporal variance (&sigma;&sup2;&tau;)</label>
              <span id="sigma-tau-val" class="font-[family-name:var(--font-mono)] text-[var(--color-accent-secondary)]">0.10</span>
            </div>
            <input type="range" id="sigma-tau" min="0" max="2" step="0.01" value="0.10" class="w-full accent-[var(--color-accent-secondary)]" />
          </div>

          <!-- Spatial variance slider -->
          <div>
            <div class="flex justify-between text-sm mb-2">
              <label for="sigma-gamma" class="text-[var(--color-text-muted)]">Spatial variance (&sigma;&sup2;&gamma;)</label>
              <span id="sigma-gamma-val" class="font-[family-name:var(--font-mono)] text-[var(--color-accent-secondary)]">0.10</span>
            </div>
            <input type="range" id="sigma-gamma" min="0" max="2" step="0.01" value="0.10" class="w-full accent-[var(--color-accent-secondary)]" />
          </div>

          <!-- Result -->
          <div class="glass rounded-lg p-6 text-center">
            <div class="text-xs text-[var(--color-text-faint)] mb-2 font-[family-name:var(--font-mono)]">
              {COHERENCE.formula}
            </div>
            <div class="text-4xl font-bold font-[family-name:var(--font-heading)]" id="coherence-result">
              0.741
            </div>
            <div class="text-sm font-medium mt-2" id="coherence-status">
              Coherent
            </div>
            <div class="w-full h-2 rounded-full bg-[var(--color-bg-deep)] mt-4">
              <div id="coherence-bar" class="h-full rounded-full transition-all duration-300" style="width: 74.1%; background-color: #10b981;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Decision thresholds -->
      <div class="glass rounded-xl p-8">
        <h3 class="text-xl font-semibold font-[family-name:var(--font-heading)] mb-2">Decision Thresholds</h3>
        <p class="text-sm text-[var(--color-text-muted)] mb-6">
          How NSP (Neural Security Protocol) responds to coherence levels in real time.
        </p>

        <div class="space-y-4">
          <div class="glass rounded-lg p-4 border-l-4" style="border-color: #10b981;">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-sm font-semibold" style="color: #10b981;">High Coherence</span>
              <span class="text-xs font-[family-name:var(--font-mono)] text-[var(--color-text-faint)]">C<sub>s</sub> &gt; 0.6</span>
            </div>
            <p class="text-xs text-[var(--color-text-muted)]">Signal accepted. Authenticated signals pass through. Invalid auth triggers alert.</p>
          </div>
          <div class="glass rounded-lg p-4 border-l-4" style="border-color: #f59e0b;">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-sm font-semibold" style="color: #f59e0b;">Medium Coherence</span>
              <span class="text-xs font-[family-name:var(--font-mono)] text-[var(--color-text-faint)]">0.3 &lt; C<sub>s</sub> &lt; 0.6</span>
            </div>
            <p class="text-xs text-[var(--color-text-muted)]">Gateway zone. Valid auth accepted with flag for review. Invalid auth rejected with alert.</p>
          </div>
          <div class="glass rounded-lg p-4 border-l-4" style="border-color: #ef4444;">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-sm font-semibold" style="color: #ef4444;">Low Coherence</span>
              <span class="text-xs font-[family-name:var(--font-mono)] text-[var(--color-text-faint)]">C<sub>s</sub> &lt; 0.3</span>
            </div>
            <p class="text-xs text-[var(--color-text-muted)]">Breach detected. All signals rejected regardless of authentication. Critical alert raised.</p>
          </div>
        </div>

        <div class="mt-6 p-4 rounded-lg bg-[var(--color-bg-deep)]">
          <p class="text-xs text-[var(--color-text-faint)]">
            <strong class="text-[var(--color-text-muted)]">Biological basis:</strong> Phase coherence follows Fries' Communication Through Coherence (2005/2015). STDP windows of &plusmn;10&ndash;20 ms (Markram 1997, Bi &amp; Poo 1998) provide the timing constraint. The exponential form is a Boltzmann factor — the same mathematical structure as thermal physics and Shannon entropy.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Scale-Frequency Defense -->
  <section class="mb-16">
    <h2 class="text-2xl font-semibold font-[family-name:var(--font-heading)] mb-2">Scale-Frequency Defense Mapping</h2>
    <p class="text-[var(--color-text-muted)] mb-8 max-w-3xl">
      Neural oscillation bands operate at different frequencies and spatial scales. Each band represents a distinct attack surface — and a distinct layer of defense in the hourglass model.
    </p>

    <div class="glass rounded-xl p-8 max-w-2xl">
      <!-- Visual representation -->
      <div class="space-y-4 mb-8">
        {SCALE_FREQUENCY.bands.map((band) => {
          const maxExtent = 20;
          const extent = parseFloat(band.extent.replace(/[^0-9.]/g, ''));
          const percent = (extent / maxExtent) * 100;
          const freqParts = band.frequency.split('-');
          const maxFreq = parseFloat(freqParts[freqParts.length - 1]);
          const hue = maxFreq > 30 ? 280 : maxFreq > 8 ? 180 : maxFreq > 4 ? 200 : 220;
          return (
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span class="font-medium">{band.name}</span>
                <span class="text-[var(--color-text-faint)] font-[family-name:var(--font-mono)] text-xs">
                  {band.frequency} &middot; {band.extent}
                </span>
              </div>
              <div class="w-full h-8 rounded bg-[var(--color-bg-deep)] relative overflow-hidden">
                <div
                  class="h-full rounded flex items-center px-3 text-xs font-[family-name:var(--font-mono)] text-white/80"
                  style={`width: ${percent}%; background: linear-gradient(90deg, hsl(${hue}, 60%, 40%), hsl(${hue}, 60%, 30%));`}
                >
                  k &asymp; {band.k}
                </div>
              </div>
            </div>
          );
        })}
      </div>

      <div class="glass rounded-lg p-4 text-center">
        <p class="text-sm font-[family-name:var(--font-mono)] text-[var(--color-accent-tertiary)]">
          v = f &times; &lambda; &ensp;&rarr;&ensp; k &asymp; {SCALE_FREQUENCY.k_range}
        </p>
        <p class="text-xs text-[var(--color-text-faint)] mt-1">
          The product of frequency and spatial extent is approximately constant across neural bands.
        </p>
      </div>
    </div>
  </section>

  <!-- Ethical Neurosecurity Code of Ethics (driven by src/data/code-of-ethics.ts) -->
  <section class="mb-16" id="ethics">
    <h2 class="text-2xl font-semibold font-[family-name:var(--font-heading)] mb-2">Ethical Neurosecurity Code of Ethics</h2>
    <p class="text-xs text-[var(--color-text-faint)] mb-4">
      v{ETHICS_VERSION} ({ETHICS_STATUS}) &middot; This document is also available on <a href="https://github.com/qinnovates/qinnovate/blob/main/governance/ETHICAL-NEUROSECURITY-CODE-OF-ETHICS.md" class="text-[var(--color-accent-secondary)] hover:underline">GitHub</a>. Initial drafts are synthesized by the author with AI assistance. Final versions require human collaborators and reviewers to identify gaps, errors, and cognitive biases.
    </p>
    <p class="text-[var(--color-text-muted)] mb-4 max-w-3xl">
      This code adapts the structure and principles of the <a href={FRAMEWORK_LINKS.ceh} class="text-[var(--color-accent-secondary)] hover:underline">EC-Council Certified Ethical Hacker (CEH) Code of Ethics</a> and the <a href={FRAMEWORK_LINKS.isc2} class="text-[var(--color-accent-secondary)] hover:underline">(ISC)&sup2; Code of Ethics</a> for the neurosecurity domain. Ethical hacking already solved many governance problems for traditional systems. We are taking those lessons and applying them where the stakes are highest: the human brain.
    </p>
    <p class="text-[var(--color-text-muted)] mb-8 max-w-3xl">
      Each principle below is cross-referenced to the international frameworks that inform it: the <a href={FRAMEWORK_LINKS.oecd} class="text-[var(--color-accent-secondary)] hover:underline">OECD Recommendation on Neurotechnology</a> (2019), <a href={FRAMEWORK_LINKS.unescoAi} class="text-[var(--color-accent-secondary)] hover:underline">UNESCO Recommendation on the Ethics of AI</a> (2021), the <a href={FRAMEWORK_LINKS.belmont} class="text-[var(--color-accent-secondary)] hover:underline">Belmont Report</a> (1979), the <a href={FRAMEWORK_LINKS.helsinki} class="text-[var(--color-accent-secondary)] hover:underline">Declaration of Helsinki</a>, the <a href={FRAMEWORK_LINKS.chileNeurorights} class="text-[var(--color-accent-secondary)] hover:underline">Chilean Neurorights Law</a> (2021), <a href={FRAMEWORK_LINKS.gdpr9} class="text-[var(--color-accent-secondary)] hover:underline">GDPR Article 9</a>, the <a href={FRAMEWORK_LINKS.ieeeNeuroethics} class="text-[var(--color-accent-secondary)] hover:underline">IEEE Neuroethics Framework</a>, <a href={FRAMEWORK_LINKS.budapest} class="text-[var(--color-accent-secondary)] hover:underline">Budapest Convention on Cybercrime</a>, and the five neurorights proposed by <a href={FRAMEWORK_LINKS.yuste} class="text-[var(--color-accent-secondary)] hover:underline">Yuste et al.</a> and <a href={FRAMEWORK_LINKS.ienca} class="text-[var(--color-accent-secondary)] hover:underline">Ienca &amp; Andorno</a>.
    </p>

    <!-- Preamble -->
    <div class="glass rounded-xl p-8 mb-8 max-w-4xl">
      <h3 class="text-xl font-semibold font-[family-name:var(--font-heading)] mb-3">Preamble</h3>
      {PREAMBLE.map((p, i) => (
        <p class={`text-[var(--color-text-muted)] ${i < PREAMBLE.length - 1 ? 'mb-3' : ''}`}>{p}</p>
      ))}
    </div>

    <!-- The Four Canons (adapted from ISC²) -->
    <div class="mb-8 max-w-4xl">
      <h3 class="text-xl font-semibold font-[family-name:var(--font-heading)] mb-4">The Four Canons</h3>
      <p class="text-sm text-[var(--color-text-faint)] mb-4">Adapted from (ISC)&sup2; Code of Ethics. These are the highest-level obligations.</p>
      <div class="grid sm:grid-cols-2 gap-4">
        {CANONS.map((canon) => (
          <div class="glass rounded-xl p-6 border-l-4" style={`border-color: ${canon.color};`}>
            <h4 class="font-semibold mb-2">{canon.number}. {canon.title}</h4>
            <p class="text-sm text-[var(--color-text-muted)]">{canon.description}</p>
            <p class="text-xs text-[var(--color-text-faint)] mt-2">Sources: {canon.sources}</p>
          </div>
        ))}
      </div>
    </div>

    <!-- The Principles (adapted from CEH + frameworks) -->
    <div class="max-w-4xl">
      <h3 class="text-xl font-semibold font-[family-name:var(--font-heading)] mb-4">The Principles</h3>
      <p class="text-sm text-[var(--color-text-faint)] mb-6">Adapted from the EC-Council CEH Code of Ethics and mapped across neurorights, bioethics, digital ethics, and international law.</p>

      <div class="space-y-4">
        {PRINCIPLES.map((p) => (
          <div class="glass rounded-lg p-6">
            <div class="flex items-start gap-3">
              <span class="text-lg font-bold text-[var(--color-accent-secondary)] shrink-0">{p.number}</span>
              <div>
                <h4 class="font-semibold mb-1">{p.title}</h4>
                <p class="text-sm text-[var(--color-text-muted)] mb-2" set:html={p.description
                  .replace(
                    /A Neurorights Foundation audit \(https:\/\/[^)]+\)/,
                    `A <a href="${FRAMEWORK_LINKS.neurorightsAudit}" class="text-[var(--color-accent-secondary)] hover:underline">Neurorights Foundation audit</a>`
                  )
                  .replace(
                    /Mexico's GLNN bill \(introduced 2024, published in The Lancet Psychiatry: https:\/\/[^)]+\)/,
                    `Mexico's GLNN bill (introduced 2024, published in <a href="${FRAMEWORK_LINKS.lancetGlnn}" class="text-[var(--color-accent-secondary)] hover:underline">The Lancet Psychiatry</a>)`
                  )
                  .replace(
                    /the TARA registry/,
                    `the <a href="/TARA/" class="text-[var(--color-accent-secondary)] hover:underline">TARA registry</a>`
                  )
                } />
                <p class="text-xs text-[var(--color-text-faint)]">{p.sources}</p>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Cross-Reference Table -->
    <div class="mt-8 max-w-4xl">
      <h3 class="text-xl font-semibold font-[family-name:var(--font-heading)] mb-4">Framework Cross-Reference</h3>
      <p class="text-sm text-[var(--color-text-faint)] mb-4">How each principle maps to existing ethics frameworks. This code does not exist in a vacuum. It stands on the shoulders of decades of work in cybersecurity ethics, bioethics, neurorights, and international law.</p>
      <div class="overflow-x-auto">
        <table class="w-full text-xs border-collapse">
          <thead>
            <tr class="text-left border-b border-[var(--color-border)]">
              <th class="p-2 text-[var(--color-text-faint)]">Principle</th>
              <th class="p-2 text-[var(--color-text-faint)]">CEH / (ISC)&sup2;</th>
              <th class="p-2 text-[var(--color-text-faint)]">Bioethics</th>
              <th class="p-2 text-[var(--color-text-faint)]">Neurorights</th>
              <th class="p-2 text-[var(--color-text-faint)]">Digital / Intl Law</th>
            </tr>
          </thead>
          <tbody class="text-[var(--color-text-muted)]">
            {CROSS_REFERENCES.map((ref, i) => (
              <tr class={i < CROSS_REFERENCES.length - 1 ? 'border-b border-[var(--color-border)]/30' : ''}>
                <td class="p-2 font-medium">{ref.principle}</td>
                <td class="p-2">{ref.cehIsc2}</td>
                <td class="p-2">{ref.bioethics}</td>
                <td class="p-2">{ref.neurorights}</td>
                <td class="p-2">{ref.digitalIntlLaw}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Version & License -->
    <div class="mt-8 glass rounded-lg p-6 max-w-4xl">
      <p class="text-sm text-[var(--color-text-muted)]">
        <strong class="text-[var(--color-text)]">Version {ETHICS_VERSION}</strong> ({ETHICS_STATUS}) &middot; {ETHICS_DATE} &middot; Written by {ETHICS_AUTHOR} &middot; <a href={ETHICS_LICENSE_URL} class="text-[var(--color-accent-secondary)] hover:underline">{ETHICS_LICENSE}</a>
      </p>
      <p class="text-xs text-[var(--color-text-faint)] mt-2">
        This code is a living document. If you work in neurosecurity and see something missing, open an issue or submit a pull request on <a href="https://github.com/qinnovates/qinnovate/blob/main/governance/ETHICAL-NEUROSECURITY-CODE-OF-ETHICS.md" class="text-[var(--color-accent-secondary)] hover:underline">GitHub</a>. The point is to get this right, not to get it first.
      </p>
    </div>
  </section>

  <!-- Security Architecture Links -->
  <section>
    <h2 class="text-2xl font-semibold font-[family-name:var(--font-heading)] mb-6">Explore Further</h2>
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <a href="/TARA/" class="glass rounded-xl p-6 block group hover:translate-y-[-2px] transition-transform">
        <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)] mb-2 group-hover:text-[var(--color-accent-secondary)] transition-colors">TARA Atlas</h3>
        <p class="text-sm text-[var(--color-text-muted)]">Browse all 103+ attack techniques mapped across the hourglass model, filterable by category, severity, and brain region.</p>
      </a>
      <a href="/framework/" class="glass rounded-xl p-6 block group hover:translate-y-[-2px] transition-transform">
        <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)] mb-2 group-hover:text-[var(--color-accent-secondary)] transition-colors">QIF Framework</h3>
        <p class="text-sm text-[var(--color-text-muted)]">The 11-band hourglass architecture — layered defense from electromagnetic fields to cognitive state.</p>
      </a>
      <a href="/nsp/" class="glass rounded-xl p-6 block group hover:translate-y-[-2px] transition-transform">
        <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)] mb-2 group-hover:text-[var(--color-accent-secondary)] transition-colors">NSP Protocol</h3>
        <p class="text-sm text-[var(--color-text-muted)]">Post-quantum wire security for neural interfaces — 5-layer defense stack with coherence-gated authentication.</p>
      </a>
      <a href="/scoring/" class="glass rounded-xl p-6 block group hover:translate-y-[-2px] transition-transform">
        <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)] mb-2 group-hover:text-[var(--color-accent-secondary)] transition-colors">NISS Scoring</h3>
        <p class="text-sm text-[var(--color-text-muted)]">Neural Impact Scoring System — vulnerability severity designed for brains, not servers.</p>
      </a>
      <a href="/runemate/" class="glass rounded-xl p-6 block group hover:translate-y-[-2px] transition-transform">
        <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)] mb-2 group-hover:text-[var(--color-accent-secondary)] transition-colors">Project Runemate</h3>
        <p class="text-sm text-[var(--color-text-muted)]">Native multimodal DSL compiler — PQ-encrypted content delivery small enough for implanted chips.</p>
      </a>
      <a href="/neurogovernance/" class="glass rounded-xl p-6 block group hover:translate-y-[-2px] transition-transform">
        <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)] mb-2 group-hover:text-[var(--color-accent-secondary)] transition-colors">Neurogovernance</h3>
        <p class="text-sm text-[var(--color-text-muted)]">How neurorights and policy frameworks protect the people behind the interfaces.</p>
      </a>
      <a href="https://github.com/qinnovates/qinnovate/blob/main/qif-framework/qif-sec-guardrails.md" class="glass rounded-xl p-6 block group hover:translate-y-[-2px] transition-transform">
        <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)] mb-2 group-hover:text-[var(--color-accent-secondary)] transition-colors">Security Guardrails</h3>
        <p class="text-sm text-[var(--color-text-muted)]">Physics-derived defense architecture for BCI systems, mapping coherence thresholds to per-band protection rules.</p>
      </a>
    </div>
  </section>
</PageLayout>

<script>
  const sliders = ['sigma-phi', 'sigma-tau', 'sigma-gamma'].map((id) => ({
    input: document.getElementById(id) as HTMLInputElement,
    display: document.getElementById(`${id}-val`) as HTMLElement,
  }));

  const result = document.getElementById('coherence-result')!;
  const status = document.getElementById('coherence-status')!;
  const bar = document.getElementById('coherence-bar')!;

  function updateCoherence() {
    const values = sliders.map((s) => parseFloat(s.input.value));
    values.forEach((v, i) => {
      sliders[i].display.textContent = v.toFixed(2);
    });

    const sum = values.reduce((a, b) => a + b, 0);
    const cs = Math.exp(-sum);

    result.textContent = cs.toFixed(3);
    bar.style.width = `${cs * 100}%`;

    if (cs > 0.6) {
      result.style.color = '#10b981';
      status.textContent = 'Coherent';
      status.style.color = '#10b981';
      bar.style.backgroundColor = '#10b981';
    } else if (cs > 0.3) {
      result.style.color = '#f59e0b';
      status.textContent = 'Gateway';
      status.style.color = '#f59e0b';
      bar.style.backgroundColor = '#f59e0b';
    } else {
      result.style.color = '#ef4444';
      status.textContent = 'Breach';
      status.style.color = '#ef4444';
      bar.style.backgroundColor = '#ef4444';
    }
  }

  sliders.forEach((s) => {
    s.input.addEventListener('input', updateCoherence);
  });

  updateCoherence();
</script>
