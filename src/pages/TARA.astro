---
import PageLayout from '../layouts/PageLayout.astro';
import { HOURGLASS_BANDS } from '../lib/qif-constants';
import { THREAT_VECTORS, getStatusStats } from '../lib/threat-data';
import TaraVisualization from '../components/TaraVisualization';

const statusStats = getStatusStats();
const bands = [...HOURGLASS_BANDS];

// TARA Categories (simplified for display)
const THREAT_CATEGORIES = [
  { id: 'SI', name: 'Signal Injection', description: 'Injecting false neural or electronic signals' },
  { id: 'SE', name: 'Signal Eavesdropping', description: 'Intercepting signals in transit' },
  { id: 'DM', name: 'Data Manipulation', description: 'Altering decoded intent or recordings' },
  { id: 'DS', name: 'Denial of Service', description: 'Disrupting BCI function' },
  { id: 'PE', name: 'Privilege Escalation', description: 'Gaining unauthorized access depth' },
  { id: 'CI', name: 'Cognitive Integrity', description: 'Thought privacy, perception, identity threats' },
  { id: 'PS', name: 'Physical Safety', description: 'Tissue damage, seizures, involuntary movement' },
  { id: 'EX', name: 'Data Exfiltration', description: 'Extracting neural data for exploitation' },
];
---

<PageLayout
  title="TARA Atlas — Neural Security Command"
  description={`${THREAT_VECTORS.length} BCI techniques mapped across the bio-digital bridge.`}
  breadcrumbs={[{ label: 'Explore', href: '/explore/' }, { label: 'TARA Atlas' }]}
  wide={true}
>
  <div id="tara-command-center" class="min-h-screen -mt-4 pt-4">
    <div class="max-w-[1400px] mx-auto">
      <div class="mb-12">
        <div class="flex flex-col lg:flex-row lg:items-end justify-between gap-10 mb-16">
          <div class="max-w-3xl">
            <div class="flex items-center gap-3 mb-6">
                <span class="text-[11px] font-semibold text-slate-400 uppercase tracking-widest">TARA Atlas v1.6</span>
                <span class="w-1 h-1 rounded-full bg-slate-300"></span>
                <span class="text-[11px] font-semibold text-emerald-500 uppercase tracking-widest">Stable</span>
            </div>
            <h1 class="text-5xl sm:text-7xl font-semibold tracking-tight text-slate-900 mb-6">
              The TARA Atlas
            </h1>
            <p class="text-2xl text-slate-500 font-medium leading-relaxed tracking-tight">
              A dual-use registry of neurotechnology techniques. Explore biological and digital security risks cross-referenced with therapeutic applications.
            </p>
          </div>
          
          <div class="flex flex-row sm:flex-col gap-4">
              <div class="bg-white px-8 py-5 rounded-[2rem] border border-slate-100 shadow-sm min-w-[200px]">
                  <span class="block text-[11px] text-slate-400 font-semibold mb-1">Total Techniques</span>
                  <div class="flex items-baseline gap-2">
                    <span class="text-3xl font-semibold text-slate-900">{THREAT_VECTORS.length}</span>
                  </div>
              </div>
              <div class="bg-slate-900 px-8 py-5 rounded-[2rem] shadow-xl shadow-slate-900/10 min-w-[200px]">
                  <span class="block text-[11px] text-slate-500 font-semibold mb-1">Critical Paths</span>
                  <div class="flex items-baseline gap-2">
                    <span class="text-3xl font-semibold text-red-500">{statusStats.CONFIRMED + statusStats.DEMONSTRATED}</span>
                  </div>
              </div>
          </div>
        </div>

        <div class="mt-8">
          <TaraVisualization 
            client:only="react" 
            threats={THREAT_VECTORS} 
            categories={THREAT_CATEGORIES} 
            bands={bands} 
          />
        </div>

        <div class="mt-32 pt-16 border-t border-slate-100 max-w-5xl">
            <h2 class="text-3xl font-semibold tracking-tight text-slate-900 mb-6">API & Adoption</h2>
            <p class="text-lg text-slate-500 font-medium leading-relaxed mb-10">
                The TARA Atlas is designed to be integrated into security platforms, research pipelines, and BCI firmware. Use the official SDK or raw STIX 2.1 datasets to leverage these mappings in your own projects.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="p-8 rounded-[2rem] bg-slate-50 border border-slate-100">
                    <h3 class="text-xl font-semibold text-slate-900 mb-4">Python SDK</h3>
                    <p class="text-sm text-slate-500 mb-6 font-medium">Install the official TARA SDK to load the registry, filter techniques, and export to STIX format.</p>
                    <div class="bg-slate-900 rounded-xl p-5 mb-6 overflow-x-auto">
                        <code class="text-blue-400 text-xs font-mono">pip install qtara</code>
                    </div>
<pre class="bg-slate-900 rounded-xl p-5 text-[11px] text-slate-300 font-mono overflow-x-auto">
<span class="text-purple-400">from</span> qtara <span class="text-purple-400">import</span> TaraRegistry

registry = TaraRegistry.load()
techniques = registry.get_techniques()
print(<span class="text-emerald-400">f"Loaded {'{'}techniques.length{'}'} mappings"</span>)</pre>
                    <a href="https://pypi.org/project/qtara/" target="_blank" class="inline-block mt-8 text-sm font-semibold text-blue-600 hover:text-blue-800 transition-colors">
                        PyPI Documentation →
                    </a>
                </div>

                <div class="p-8 rounded-[2rem] bg-slate-50 border border-slate-100">
                    <h3 class="text-xl font-semibold text-slate-900 mb-4">Raw Data & Feeds</h3>
                    <p class="text-sm text-slate-500 mb-6 font-medium">Access the canonical registry data in STIX 2.1 or flat JSON format for direct integration.</p>
                    <ul class="space-y-4">
                        <li>
                            <a href="/api/stix.json" class="flex items-center justify-between p-4 bg-white rounded-xl border border-slate-200 hover:border-blue-500 transition-all group">
                                <span class="text-xs font-semibold text-slate-700">STIX 2.1 Feed</span>
                                <span class="text-[10px] text-slate-400 font-mono group-hover:text-blue-500">JSON</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://raw.githubusercontent.com/qinnovates/qinnovate/main/shared/qtara-registrar.json" class="flex items-center justify-between p-4 bg-white rounded-xl border border-slate-200 hover:border-blue-500 transition-all group">
                                <span class="text-xs font-semibold text-slate-700">TARA Registrar</span>
                                <span class="text-[10px] text-slate-400 font-mono group-hover:text-blue-500">JSON</span>
                            </a>
                        </li>
                    </ul>
                    <div class="mt-10 p-5 rounded-2xl bg-blue-50 border border-blue-100">
                        <p class="text-[11px] text-blue-700 font-medium leading-relaxed italic">
                            All TARA techniques are mapped to MITRE-compatible IDs (QIF-T0001+) and include NISS v1.0 impact vectors for neural risk scoring.
                        </p>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </div>
  </div>
</PageLayout>
