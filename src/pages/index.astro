---
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import TrustBar from '../components/TrustBar.astro';
import PublicationCard from '../components/PublicationCard.astro';
import { getCollection } from 'astro:content';
import { getPostDate } from '../lib/utils';
import { HOURGLASS_BANDS, STATS, PILLARS } from '../lib/qif-constants';
import HeroParticles from '../components/HeroParticles';
import '../styles/global.css';

const posts = (await getCollection('blog'))
  .sort((a, b) => new Date(getPostDate(b.data)).getTime() - new Date(getPostDate(a.data)).getTime())
  .slice(0, 4);

---

<BaseLayout title="Qinnovate — Open Standards for the Governance of Neurotechnology" description="Qinnovate develops open standards for the governance of neurotechnology — bridging security engineering and neuroethics. Home of QIF, NSP, and TARA.">
  <Nav />

  <!-- ═══ HERO + THREE PILLARS ═══ -->
  <section class="relative min-h-screen flex flex-col items-center justify-center px-4 overflow-hidden">
    <!-- Gradient background -->
    <div class="absolute inset-0 bg-[var(--color-bg-deep)]">
      <div class="absolute inset-0 opacity-30" style="background: radial-gradient(ellipse at 50% 30%, rgba(59,130,246,0.15) 0%, transparent 60%), radial-gradient(ellipse at 30% 70%, rgba(6,182,212,0.1) 0%, transparent 50%), radial-gradient(ellipse at 70% 60%, rgba(139,92,246,0.08) 0%, transparent 50%);"></div>
    </div>

    <!-- Hero particle system (React island) -->
    <HeroParticles client:idle />

    <div class="relative z-10 text-center max-w-5xl mx-auto pt-24">
      <p class="text-sm font-bold tracking-[0.2em] uppercase text-[#d4a017] mb-6">
        Open Standards for the Governance of Neurotechnology
      </p>

      <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold font-[family-name:var(--font-heading)] tracking-tight mb-6 leading-[1.1]">
        <span class="text-[var(--color-text-primary)]">Every technique that can harm a brain</span>
        <br />
        <span class="bg-gradient-to-r from-[var(--color-accent-primary)] via-[var(--color-accent-secondary)] to-[var(--color-accent-tertiary)] bg-clip-text text-transparent">
          can also heal one
        </span>
      </h1>

      <p class="text-lg sm:text-xl text-[var(--color-text-muted)] mb-12 max-w-2xl mx-auto leading-relaxed">
        The first open standard mapping BCI techniques to neural mechanisms, clinical outcomes, and psychiatric diagnoses. Qinnovate builds the governance frameworks the neural frontier needs — before mass adoption, not after.
      </p>

      <!-- Three Pillars — integrated into hero -->
      <div class="grid md:grid-cols-3 gap-4 mb-10 text-left max-w-4xl mx-auto">
        {PILLARS.map((pillar) => (
          <a href={pillar.href} class="glass rounded-xl p-5 card-hover group">
            <div class="flex items-center gap-2 mb-3">
              <div class="text-xl" style={`color: ${pillar.color}`} set:html={pillar.icon} />
              <h3 class="text-base font-semibold font-[family-name:var(--font-heading)] group-hover:text-[var(--color-accent-primary)] transition-colors">
                {pillar.name}
              </h3>
              <span class="text-[10px] px-1.5 py-0.5 rounded-full border border-[var(--color-border)] text-[var(--color-text-faint)] ml-auto whitespace-nowrap">
                v{pillar.version}
              </span>
            </div>
            <p class="text-xs text-[var(--color-text-faint)] mb-1.5 font-medium">{pillar.tagline}</p>
            <p class="text-sm text-[var(--color-text-muted)] leading-relaxed">
              {pillar.description}
            </p>
          </a>
        ))}
      </div>

      <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-6">
        <a
          href="/whitepaper/"
          class="px-6 py-3 rounded-lg bg-[var(--color-accent-primary)] text-white font-medium hover:bg-[var(--color-accent-primary)]/90 transition-colors"
        >
          Read the Whitepaper
        </a>
        <a
          href="/framework/"
          class="px-6 py-3 rounded-lg glass text-[var(--color-text-primary)] font-medium hover:bg-white/10 transition-colors"
        >
          Explore the Framework
        </a>
      </div>

      <TrustBar />
    </div>

    <!-- Scroll indicator -->
    <div class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce">
      <svg class="w-5 h-5 text-[var(--color-text-faint)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
      </svg>
    </div>
  </section>

  <!-- ═══ MILESTONE CALLOUT ═══ -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="glass rounded-xl p-6 sm:p-8 reveal" style="border-left: 4px solid var(--color-accent-secondary);">
      <div class="flex flex-col sm:flex-row sm:items-center gap-4">
        <div class="flex-1">
          <p class="text-xs font-semibold tracking-[0.15em] uppercase text-[var(--color-accent-secondary)] mb-2">New</p>
          <h3 class="text-lg font-bold font-[family-name:var(--font-heading)] mb-2">
            Neural Impact Chain
          </h3>
          <p class="text-sm text-[var(--color-text-muted)] leading-relaxed">
            First formal mapping between BCI security techniques and DSM-5-TR psychiatric diagnoses via neural mechanism chains. Every attack vector is now traced from physical mechanism to clinical outcome.
          </p>
        </div>
        <div class="flex flex-col sm:flex-row gap-3 shrink-0">
          <a
            href="/TARA/#diagnostic"
            class="px-5 py-2.5 rounded-lg bg-[var(--color-accent-secondary)] text-white font-medium text-sm hover:bg-[var(--color-accent-secondary)]/90 transition-colors text-center"
          >
            Explore Diagnostic View
          </a>
          <a
            href="/news/"
            class="px-5 py-2.5 rounded-lg glass text-[var(--color-text-primary)] font-medium text-sm hover:bg-white/10 transition-colors text-center"
          >
            Read the Blog
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- ═══ THE ROAD AHEAD ═══ -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <a href="/runemate/" class="block glass rounded-2xl p-8 sm:p-10 card-hover group relative overflow-hidden reveal" style="border: 1px solid rgba(139,92,246,0.2); background: linear-gradient(135deg, rgba(139,92,246,0.05) 0%, rgba(59,130,246,0.05) 100%);">
      <div class="absolute top-0 right-0 w-64 h-64 opacity-[0.03] pointer-events-none" style="background: radial-gradient(circle, var(--color-accent-tertiary), transparent 70%);"></div>
      <div class="flex flex-col sm:flex-row sm:items-center gap-6">
        <div class="flex-1">
          <p class="text-xs font-semibold tracking-[0.15em] uppercase text-[var(--color-accent-tertiary)] mb-2">Where This Is Going</p>
          <h2 class="text-xl sm:text-2xl font-bold font-[family-name:var(--font-heading)] mb-3 group-hover:text-[var(--color-accent-tertiary)] transition-colors">
            Project Runemate
          </h2>
          <p class="text-sm text-[var(--color-text-muted)] leading-relaxed max-w-2xl">
            The open standards that built today's internet — HTTP, TCP/IP, HTML, OSI — need equivalents for the neural frontier. Runemate demonstrates their feasibility: a bytecode compiler that compresses BCI data 65-90%, making post-quantum encryption viable on low-power implantable devices. This is a critical step toward protecting patients from unauthorized neural access — laying the foundation for a trustworthy neural web. Written in Rust. 200 KB on-chip.
          </p>
        </div>
        <div class="text-[var(--color-accent-tertiary)] opacity-60 group-hover:opacity-100 transition-opacity shrink-0">
          <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        </div>
      </div>
    </a>
  </section>

  <!-- ═══ HOURGLASS PREVIEW ═══ -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24">
    <div class="text-center mb-12 reveal">
      <h2 class="text-3xl font-bold font-[family-name:var(--font-heading)] mb-4">The Hourglass</h2>
      <p class="text-[var(--color-text-muted)] max-w-2xl mx-auto">
        The QIF framework models the entire neurotechnology stack — from neural tissue to wireless telemetry — as an 11-band hourglass. Its 7-1-3 architecture places the physical brain-computer interface at the critical waist: the convergence point for both technical and ethical controls.
      </p>
    </div>

    <!-- Static hourglass visualization (Three.js island will enhance) -->
    <div class="max-w-md mx-auto space-y-2 reveal reveal-stagger" id="hourglass-preview">
      {HOURGLASS_BANDS.map((band, i) => {
        const widths = [90, 82, 72, 62, 55, 45, 38, 30, 45, 58, 75];
        const width = widths[i];
        return (
          <div class="flex items-center gap-3 group cursor-pointer" title={band.description}>
            <span class="text-xs text-[var(--color-text-faint)] w-8 text-right font-mono">{band.id}</span>
            <div
              class="h-8 rounded-md flex items-center px-3 transition-all group-hover:scale-[1.02] group-hover:brightness-125"
              style={`width: ${width}%; background: ${band.color}38; border: 1px solid ${band.color}60; margin: 0 auto;`}
            >
              <span class="text-xs font-medium" style={`color: ${band.color}`}>{band.name}</span>
            </div>
          </div>
        );
      })}
    </div>

    <div class="text-center mt-8">
      <a href="/framework/" class="text-sm text-[var(--color-accent-primary)] hover:text-[var(--color-accent-secondary)] transition-colors">
        Explore the full interactive model &rarr;
      </a>
    </div>
  </section>

  <!-- ═══ LATEST PUBLICATIONS ═══ -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24">
    <div class="flex items-center justify-between mb-8 reveal">
      <h2 class="text-3xl font-bold font-[family-name:var(--font-heading)]">Latest News</h2>
      <a href="/news/" class="text-sm text-[var(--color-accent-primary)] hover:text-[var(--color-accent-secondary)] transition-colors">
        View all &rarr;
      </a>
    </div>

    <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6 reveal reveal-stagger">
      {posts.map((post) => (
        <PublicationCard
          title={post.data.title}
          date={post.data.date_posted || post.data.date || new Date()}
          tags={post.data.tags}
          slug={post.id}
          body={post.body || ''}
        />
      ))}
    </div>
  </section>

  <!-- ═══ ADOPTION CTA ═══ -->
  <section class="border-t border-[var(--color-border)] bg-[var(--color-bg-deep)]">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center reveal">
      <h2 class="text-2xl sm:text-3xl font-bold font-[family-name:var(--font-heading)] mb-4">
        The standard is open. Start here.
      </h2>
      <p class="text-[var(--color-text-muted)] max-w-2xl mx-auto mb-8">
        No login, no paywall. Read the spec, explore the threat registry, and adopt the standard at your own pace.
      </p>
      <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
        <a
          href="/TARA/"
          class="px-8 py-3.5 rounded-lg bg-[var(--color-accent-primary)] text-white font-medium hover:bg-[var(--color-accent-primary)]/90 transition-colors"
        >
          Explore the Standard
        </a>
        <a
          href="/adopt/"
          class="px-8 py-3.5 rounded-lg glass text-[var(--color-text-primary)] font-medium hover:bg-white/10 transition-colors"
        >
          Get Involved
        </a>
      </div>
    </div>
  </section>

  <Footer />
</BaseLayout>
