---
import PageLayout from '../layouts/PageLayout.astro';
import BrainVisualization from '../components/brain/BrainVisualization';
import NeurorightCards from '../components/neurogovernance/NeurorightCards';
import { getNeurogovernanceData } from '../lib/neurogovernance-data';
import { getBrainViewData } from '../lib/brain-view-data';
import { HOURGLASS_BANDS, HOURGLASS_WIDTHS } from '../lib/qif-constants';

const data = getNeurogovernanceData();
const brainViews = getBrainViewData();

const breadcrumbs = [
  { label: 'Neurogovernance' },
];
---

<PageLayout
  title="Neurogovernance — Your Brain Has Rights"
  description="An interactive map of 5 neurorights, 102 BCI attack techniques, and the brain regions they protect. The first framework to quantify what neural security means for patients."
  breadcrumbs={breadcrumbs}
  wide
>

  <!-- ═══ HERO ═══ -->
  <section class="py-12 md:py-20">
    <div class="text-center max-w-3xl mx-auto mb-12">
      <p class="text-xs font-medium tracking-[0.2em] uppercase mb-4 text-[var(--color-text-faint)]">
        Neurogovernance Map
      </p>
      <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold font-[family-name:var(--font-heading)] tracking-tight mb-6 leading-[1.15]">
        <span class="text-[var(--color-text-primary)]">Your Brain Has Rights.</span>
        <br />
        <span class="bg-gradient-to-r from-[var(--color-accent-primary)] via-[var(--color-accent-secondary)] to-[var(--color-accent-tertiary)] bg-clip-text text-transparent">
          Here's How We Protect Them.
        </span>
      </h1>
      <p class="text-base sm:text-lg text-[var(--color-text-muted)] max-w-2xl mx-auto leading-relaxed">
        Every brain-computer interface creates a surface that can be attacked. We mapped {data.stats.totalThreats} techniques
        to the {data.stats.totalRights} neurorights they violate and the brain regions they target.
      </p>
    </div>

    <!-- Stats bar -->
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 max-w-3xl mx-auto mb-12">
      <div class="glass rounded-lg p-4 text-center">
        <p class="text-2xl sm:text-3xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-accent-primary)]">
          {data.stats.totalRights}
        </p>
        <p class="text-[10px] sm:text-xs text-[var(--color-text-muted)] mt-1 leading-tight">neurorights<br/>defined</p>
      </div>
      <div class="glass rounded-lg p-4 text-center">
        <p class="text-2xl sm:text-3xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-accent-secondary)]">
          {data.stats.totalThreats}
        </p>
        <p class="text-[10px] sm:text-xs text-[var(--color-text-muted)] mt-1 leading-tight">threats<br/>mapped</p>
      </div>
      <div class="glass rounded-lg p-4 text-center">
        <p class="text-2xl sm:text-3xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-status-warn)]">
          {data.stats.cciMean}
        </p>
        <p class="text-[10px] sm:text-xs text-[var(--color-text-muted)] mt-1 leading-tight">mean CCI<br/>score</p>
      </div>
      <div class="glass rounded-lg p-4 text-center">
        <p class="text-2xl sm:text-3xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-status-danger)]">
          {data.stats.highCciCount}
        </p>
        <p class="text-[10px] sm:text-xs text-[var(--color-text-muted)] mt-1 leading-tight">high-impact<br/>techniques (CCI &gt; 2)</p>
      </div>
    </div>

    <!-- Brain SVG -->
    <div class="glass rounded-2xl p-6 sm:p-8 max-w-4xl mx-auto reveal">
      <BrainVisualization
        client:only="react"
        views={brainViews}
        defaultView="governance"
      />
    </div>
  </section>

  <!-- ═══ NEURORIGHT CARDS ═══ -->
  <section class="py-12 md:py-16" id="rights">
    <div class="flex items-center gap-4 mb-8">
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
      <h2 class="text-lg sm:text-xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] whitespace-nowrap">
        The 5 Neurorights
      </h2>
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
    </div>

    <p class="text-sm text-[var(--color-text-muted)] max-w-2xl mx-auto text-center mb-6">
      Four rights from Ienca &amp; Andorno (2017). One proposed by QIF to fill a genuine gap in the literature.
      Two existing rights extended with engineering-level depth from {data.stats.totalThreats} attack techniques.
    </p>

    <div class="glass rounded-xl p-5 max-w-2xl mx-auto mb-8 text-xs text-[var(--color-text-muted)] leading-relaxed space-y-3">
      <p>
        <strong class="text-[var(--color-text-primary)]">Mental Privacy (MP)</strong> protects against <em>reading</em> your neural data &mdash;
        exfiltration, surveillance, and re-identification across datasets. QIF extends MP with data-lifecycle protections:
        cross-modal re-linking, anonymization failure, and informational disassociation.
      </p>
      <p>
        <strong class="text-[var(--color-text-primary)]">Cognitive Authenticity (CA)</strong> protects against <em>writing</em> into your neural signals &mdash;
        injection, implanted thoughts, and confusion of agency. This is QIF's original contribution: no prior framework
        distinguished read-attacks (MP) from write-attacks (CA). The LSL CVE demonstrates both: Phase 2 (exfiltrate) = MP violation, Phase 3 (inject) = CA violation.
      </p>
      <p>
        <strong class="text-[var(--color-text-primary)]">Mental Integrity (MI)</strong> now includes signal dynamics &mdash;
        protecting brain rhythms, oscillatory timing, and homeostatic equilibria from covert disruption. QIF extends MI
        with engineering-level specifications for detecting dynamical retuning attacks.
      </p>
      <p class="text-[10px] text-[var(--color-text-faint)]">
        Click any card below to see the highest-impact threats for each right.
      </p>
    </div>

    <div class="reveal">
      <NeurorightCards client:visible neurorights={data.neurorights} />
    </div>
  </section>

  <!-- ═══ HOURGLASS CONTEXT ═══ -->
  <section class="py-12 md:py-16" id="hourglass">
    <div class="flex items-center gap-4 mb-8">
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
      <h2 class="text-lg sm:text-xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] whitespace-nowrap">
        The Hourglass Model
      </h2>
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
    </div>

    <div class="glass rounded-2xl p-6 sm:p-8 max-w-3xl mx-auto reveal">
      <p class="text-sm text-[var(--color-text-muted)] mb-6 text-center leading-relaxed">
        Each neuroright maps to specific bands in the QIF security model. The hourglass traces
        signals from the brain (N7) through the neural interface (I0) to external systems (S3).
        Every band is an attack surface.
      </p>

      <!-- Flat hourglass preview -->
      <div class="space-y-1 max-w-md mx-auto mb-6">
        {HOURGLASS_BANDS.map((band, i) => {
          const width = HOURGLASS_WIDTHS[i];
          const isInterface = band.zone === 'interface';
          return (
            <a
              href={`/lab/hourglass.html#${band.id}`}
              class:list={[
                "block mx-auto rounded-sm transition-all duration-200 hover:opacity-90 group relative",
                isInterface && "my-1"
              ]}
              style={`width: ${width}%; height: ${isInterface ? '6px' : '18px'}; background: ${band.color}; opacity: 0.8;`}
              title={`${band.id}: ${band.name} — ${band.description}`}
            >
              <span class:list={[
                "absolute inset-0 flex items-center justify-between px-2 text-[9px] font-mono text-white/80 opacity-0 group-hover:opacity-100 transition-opacity",
                isInterface && "hidden"
              ]}>
                <span>{band.id}</span>
                <span class="hidden sm:inline">{band.name}</span>
              </span>
            </a>
          );
        })}
      </div>

      <div class="flex items-center justify-center gap-6 text-[10px] text-[var(--color-text-faint)]">
        <span class="flex items-center gap-1.5">
          <span class="w-2 h-2 rounded-sm" style="background: #166534;"></span>
          Neural (N7–N1)
        </span>
        <span class="flex items-center gap-1.5">
          <span class="w-2 h-2 rounded-sm" style="background: #f59e0b;"></span>
          Interface (I0)
        </span>
        <span class="flex items-center gap-1.5">
          <span class="w-2 h-2 rounded-sm" style="background: #3b82f6;"></span>
          Synthetic (S1–S3)
        </span>
      </div>

      <div class="text-center mt-6">
        <a
          href="/lab/hourglass.html"
          class="inline-flex items-center gap-1.5 text-xs font-medium text-[var(--color-accent-primary)] hover:underline"
        >
          Explore full interactive hourglass
          <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- ═══ PIVOT TO TARA ═══ -->
  <section class="py-12 md:py-16" id="tara-pivot">
    <div class="flex items-center gap-4 mb-8">
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
      <h2 class="text-lg sm:text-xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] whitespace-nowrap">
        See the Full Picture
      </h2>
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
    </div>

    <div class="glass rounded-2xl p-6 sm:p-8 max-w-3xl mx-auto reveal">
      <p class="text-sm text-[var(--color-text-muted)] leading-relaxed mb-4">
        This page maps neurorights to brain regions. To see the individual attack techniques behind each threat count —
        with NISS severity scores, therapeutic analogs, and DSM-5-TR psychiatric mappings (research-based, awaiting clinical validation) — explore the TARA Atlas.
      </p>
      <p class="text-sm text-[var(--color-text-muted)] leading-relaxed mb-6">
        TARA is the full registry: {data.stats.totalThreats} techniques scored across four projections (security, clinical,
        diagnostic, governance). Each technique traces through the Neural Impact Chain from physical mechanism
        to clinical outcome. The neurorights shown here are the governance layer that sits on top.
      </p>

      <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
        <a
          href="/TARA/"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium text-white transition-colors"
          style="background: var(--color-accent-primary);"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
          Open TARA Atlas
        </a>
        <span class="text-xs text-[var(--color-text-faint)]">
          View all {data.stats.totalThreats} techniques with full scoring and projections
        </span>
      </div>
    </div>
  </section>

  <!-- ═══ CALL TO ACTION ═══ -->
  <section class="py-12 md:py-20" id="cta">
    <div class="glass rounded-2xl p-8 sm:p-12 max-w-3xl mx-auto text-center reveal">
      <h2 class="text-2xl sm:text-3xl font-bold font-[family-name:var(--font-heading)] mb-4 text-[var(--color-text-primary)]">
        This map is open. Help us stress-test it.
      </h2>
      <p class="text-sm text-[var(--color-text-muted)] mb-8 max-w-lg mx-auto leading-relaxed">
        The QIF framework, TARA registry, and neuroright mappings are all published under Apache 2.0.
        We need clinicians, ethicists, and security researchers to challenge every assumption.
      </p>

      <div class="flex flex-wrap items-center justify-center gap-3">
        <a
          href="/whitepaper/"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium text-white transition-colors"
          style="background: var(--color-accent-primary);"
        >
          Read the Whitepaper
        </a>
        <a
          href="/TARA/"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium transition-colors"
          style="background: rgba(0,0,0,0.05); color: var(--color-text-primary);"
        >
          TARA Registry
        </a>
        <a
          href="https://github.com/qinnovates/qinnovate"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium transition-colors"
          style="background: rgba(0,0,0,0.05); color: var(--color-text-primary);"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          GitHub
        </a>
        <a
          href="https://doi.org/10.5281/zenodo.18640105"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium transition-colors"
          style="background: rgba(0,0,0,0.05); color: var(--color-text-primary);"
        >
          Zenodo Preprint
        </a>
      </div>
    </div>
  </section>

</PageLayout>

<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
