---
import PageLayout from '../layouts/PageLayout.astro';
import BrainVisualization from '../components/brain/BrainVisualization';
import NeurorightCards from '../components/neurogovernance/NeurorightCards';
import { getNeurogovernanceData } from '../lib/neurogovernance-data';
import { getBrainViewData } from '../lib/brain-view-data';
import { HOURGLASS_BANDS, HOURGLASS_WIDTHS } from '../lib/qif-constants';

const data = getNeurogovernanceData();
const brainViews = getBrainViewData();

const breadcrumbs = [
  { label: 'Neurogovernance' },
];
---

<PageLayout
  title="Neurogovernance — Your Brain Has Rights"
  description="An interactive map of 5 neurorights, 102 BCI attack techniques, and the brain regions they protect. The first framework to quantify what neural security means for patients."
  breadcrumbs={breadcrumbs}
  wide
>

  <!-- ═══ HERO ═══ -->
  <section class="py-12 md:py-20">
    <div class="text-center max-w-3xl mx-auto mb-12">
      <p class="text-xs font-medium tracking-[0.2em] uppercase mb-4 text-[var(--color-text-faint)]">
        Neurogovernance Map
      </p>
      <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold font-[family-name:var(--font-heading)] tracking-tight mb-6 leading-[1.15]">
        <span class="text-[var(--color-text-primary)]">Your Brain Has Rights.</span>
        <br />
        <span class="bg-gradient-to-r from-[var(--color-accent-primary)] via-[var(--color-accent-secondary)] to-[var(--color-accent-tertiary)] bg-clip-text text-transparent">
          Here's How We Protect Them.
        </span>
      </h1>
      <p class="text-base sm:text-lg text-[var(--color-text-muted)] max-w-2xl mx-auto leading-relaxed">
        GRC (Governance, Risk, and Compliance) was retrofitted onto IT security decades after the internet shipped.
        The result: compliance that lags threats. We are building neurogovernance into BCI security from day one.
      </p>
    </div>

    <!-- GRC Pillars -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-4xl mx-auto mb-12">
      <div class="glass rounded-xl p-5 text-center">
        <div class="w-10 h-10 rounded-lg mx-auto mb-3 flex items-center justify-center" style="background: rgba(59,130,246,0.15);">
          <svg class="w-5 h-5 text-[var(--color-accent-primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
          </svg>
        </div>
        <h3 class="text-sm font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-1">Governance</h3>
        <p class="text-xs text-[var(--color-text-muted)] leading-relaxed">
          Neurorights policies, informed consent frameworks, ethics alignment. The rules that define what's allowed before the first electrode touches tissue.
        </p>
      </div>
      <div class="glass rounded-xl p-5 text-center">
        <div class="w-10 h-10 rounded-lg mx-auto mb-3 flex items-center justify-center" style="background: rgba(239,68,68,0.15);">
          <svg class="w-5 h-5 text-[var(--color-status-danger)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
          </svg>
        </div>
        <h3 class="text-sm font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-1">Risk</h3>
        <p class="text-xs text-[var(--color-text-muted)] leading-relaxed">
          {data.stats.totalThreats} threat techniques scored with NISS. Physics-derived severity, DSM-5-TR diagnostic mappings, dual-use risk-benefit analysis.
        </p>
      </div>
      <div class="glass rounded-xl p-5 text-center">
        <div class="w-10 h-10 rounded-lg mx-auto mb-3 flex items-center justify-center" style="background: rgba(139,92,246,0.15);">
          <svg class="w-5 h-5 text-[var(--color-accent-secondary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 019 9v.375M10.125 2.25A3.375 3.375 0 0113.5 5.625v1.5c0 .621.504 1.125 1.125 1.125h1.5a3.375 3.375 0 012.25.845" />
          </svg>
        </div>
        <h3 class="text-sm font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-1">Compliance</h3>
        <p class="text-xs text-[var(--color-text-muted)] leading-relaxed">
          FDORA/FDA crosswalk, NIST SP 800-53 controls, ISO 27001 mapping, UNESCO alignment. Machine-verifiable where possible.
        </p>
      </div>
    </div>

    <!-- GRC Flow + Gap -->
    <div class="glass rounded-2xl p-6 sm:p-8 max-w-4xl mx-auto mb-12 reveal">
      <h3 class="text-base font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-2 text-center">
        How Security GRC Works
      </h3>
      <p class="text-xs text-[var(--color-text-muted)] text-center mb-6">
        This cycle drives IT security. For BCIs, it breaks at step 1: the external forces barely exist.
      </p>

      <!-- Flowchart -->
      <div class="flex flex-col items-center gap-2 max-w-sm mx-auto mb-8">
        <div class="w-full rounded-lg p-3 text-center border border-[var(--color-accent-primary)]/30" style="background: rgba(59,130,246,0.08);">
          <p class="text-xs font-bold text-[var(--color-accent-primary)] mb-0.5">1. External Forces Set Requirements</p>
          <p class="text-[10px] text-[var(--color-text-muted)]">HIPAA, PCI-DSS, SOX, GDPR, NIST CSF, ISO 27001, SOC 2</p>
        </div>
        <svg class="w-4 h-4 text-[var(--color-text-faint)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>
        <div class="w-full rounded-lg p-3 text-center border border-[var(--color-accent-secondary)]/30" style="background: rgba(139,92,246,0.08);">
          <p class="text-xs font-bold text-[var(--color-accent-secondary)] mb-0.5">2. GRC Translates Into Policy</p>
          <p class="text-[10px] text-[var(--color-text-muted)]">Maps requirements to controls, writes policies, maintains risk register</p>
        </div>
        <svg class="w-4 h-4 text-[var(--color-text-faint)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>
        <div class="w-full rounded-lg p-3 text-center border border-green-500/30" style="background: rgba(34,197,94,0.08);">
          <p class="text-xs font-bold text-green-500 mb-0.5">3. Security Engineering Implements</p>
          <p class="text-[10px] text-[var(--color-text-muted)]">Firewalls, encryption, access management, monitoring, detection</p>
        </div>
        <svg class="w-4 h-4 text-[var(--color-text-faint)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>
        <div class="w-full rounded-lg p-3 text-center border border-[var(--color-status-warn)]/30" style="background: rgba(245,158,11,0.08);">
          <p class="text-xs font-bold text-[var(--color-status-warn)] mb-0.5">4. GRC Audits Adherence</p>
          <p class="text-[10px] text-[var(--color-text-muted)]">Evidence collection, gap analysis, audit prep, remediation tracking</p>
        </div>
        <div class="flex items-center gap-2 mt-1">
          <svg class="w-3 h-3 text-[var(--color-text-faint)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" /></svg>
          <span class="text-[10px] text-[var(--color-text-faint)] italic">loops back to step 1</span>
        </div>
      </div>

      <!-- Delta table -->
      <h3 class="text-sm font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-3 text-center">
        The BCI Security Delta
      </h3>
      <div class="overflow-x-auto">
        <table class="w-full text-xs">
          <thead>
            <tr class="border-b border-[var(--color-border)]">
              <th class="text-left py-2 px-2 text-[var(--color-text-muted)] font-medium">GRC Step</th>
              <th class="text-left py-2 px-2 text-[var(--color-text-muted)] font-medium">IT Security (Mature)</th>
              <th class="text-left py-2 px-2 text-[var(--color-text-muted)] font-medium">BCI Security (Today)</th>
              <th class="text-left py-2 px-2 text-[var(--color-status-danger)] font-medium">Gap</th>
            </tr>
          </thead>
          <tbody class="text-[var(--color-text-muted)]">
            <tr class="border-b border-[var(--color-border)]/30">
              <td class="py-2 px-2 font-medium text-[var(--color-text-primary)]">Requirements</td>
              <td class="py-2 px-2">HIPAA, PCI-DSS, GDPR, FedRAMP</td>
              <td class="py-2 px-2">FDA 510(k) covers safety, not neural cybersecurity. FDORA Sec. 3305 is closest.</td>
              <td class="py-2 px-2 text-[var(--color-status-danger)]">No neural-specific regulations</td>
            </tr>
            <tr class="border-b border-[var(--color-border)]/30">
              <td class="py-2 px-2 font-medium text-[var(--color-text-primary)]">Policy</td>
              <td class="py-2 px-2">NIST CSF, ISO 27001, CIS Controls</td>
              <td class="py-2 px-2">Generic controls exist but lack neural metrics (tissue damage, cognitive integrity)</td>
              <td class="py-2 px-2 text-[var(--color-status-danger)]">No neural-aware frameworks</td>
            </tr>
            <tr class="border-b border-[var(--color-border)]/30">
              <td class="py-2 px-2 font-medium text-[var(--color-text-primary)]">Implementation</td>
              <td class="py-2 px-2">Firewalls, IDS/IPS, SIEM, IAM</td>
              <td class="py-2 px-2">No commercial BCI security tools, neural firewalls, or BCI encryption protocols</td>
              <td class="py-2 px-2 text-[var(--color-status-danger)]">Everything built from scratch</td>
            </tr>
            <tr>
              <td class="py-2 px-2 font-medium text-[var(--color-text-primary)]">Audit</td>
              <td class="py-2 px-2">SOC 2 auditors, PCI QSAs, HIPAA assessors</td>
              <td class="py-2 px-2">No BCI security auditors, no certifications, no audit criteria</td>
              <td class="py-2 px-2 text-[var(--color-status-danger)]">No one to audit against nothing</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="text-center mt-5">
        <a
          href="https://github.com/qinnovates/qinnovate/blob/main/governance/NEUROSECURITY.md#how-security-grc-actually-works"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1.5 text-xs font-medium text-[var(--color-accent-primary)] hover:underline"
        >
          Full GRC gap analysis with framework-by-framework mapping
          <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        </a>
      </div>
    </div>

    <!-- Brain SVG -->
    <div class="glass rounded-2xl p-6 sm:p-8 max-w-4xl mx-auto reveal">
      <BrainVisualization
        client:only="react"
        views={brainViews}
        defaultView="governance"
      />
    </div>
  </section>

  <!-- ═══ NEURORIGHT CARDS ═══ -->
  <section class="py-12 md:py-16" id="rights">
    <div class="flex items-center gap-4 mb-8">
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
      <h2 class="text-lg sm:text-xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] whitespace-nowrap">
        The 5 Neurorights
      </h2>
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
    </div>

    <p class="text-sm text-[var(--color-text-muted)] max-w-2xl mx-auto text-center mb-6">
      Four rights from Ienca &amp; Andorno (2017). One proposed by QIF to fill a genuine gap in the literature.
      Two existing rights extended with engineering-level depth from {data.stats.totalThreats} attack techniques.
    </p>

    <div class="glass rounded-xl p-5 max-w-2xl mx-auto mb-8 text-xs text-[var(--color-text-muted)] leading-relaxed space-y-3">
      <p>
        <strong class="text-[var(--color-text-primary)]">Mental Privacy (MP)</strong> protects against <em>reading</em> your neural data &mdash;
        exfiltration, surveillance, and re-identification across datasets. QIF extends MP with data-lifecycle protections:
        cross-modal re-linking, anonymization failure, and informational disassociation.
      </p>
      <p>
        <strong class="text-[var(--color-text-primary)]">Mental Integrity (MI)</strong> protects against <em>writing</em> into your neural signals,
        injection, implanted thoughts, confusion of agency, and signal dynamics disruption. QIF maps this to the CIA triad:
        MP = Confidentiality (don't read), MI = Integrity (don't write). The LSL CVE demonstrates both: Phase 2 (exfiltrate) = MP violation, Phase 3 (inject) = MI violation.
        QIF extends MI with engineering-level specifications for detecting dynamical retuning attacks.
      </p>
      <p class="text-[10px] text-[var(--color-text-faint)]">
        Click any card below to see the highest-impact threats for each right.
      </p>
    </div>

    <div class="reveal">
      <NeurorightCards client:visible neurorights={data.neurorights} />
    </div>
  </section>

  <!-- ═══ HOURGLASS CONTEXT ═══ -->
  <section class="py-12 md:py-16" id="hourglass">
    <div class="flex items-center gap-4 mb-8">
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
      <h2 class="text-lg sm:text-xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] whitespace-nowrap">
        The Hourglass Model
      </h2>
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
    </div>

    <div class="glass rounded-2xl p-6 sm:p-8 max-w-3xl mx-auto reveal">
      <p class="text-sm text-[var(--color-text-muted)] mb-6 text-center leading-relaxed">
        Each neuroright maps to specific bands in the QIF security model. The hourglass traces
        signals from the brain (N7) through the neural interface (I0) to external systems (S3).
        Every band is an attack surface.
      </p>

      <!-- Flat hourglass preview -->
      <div class="space-y-1 max-w-md mx-auto mb-6">
        {HOURGLASS_BANDS.map((band, i) => {
          const width = HOURGLASS_WIDTHS[i];
          const isInterface = band.zone === 'interface';
          return (
            <a
              href={`/lab/hourglass.html#${band.id}`}
              class:list={[
                "block mx-auto rounded-sm transition-all duration-200 hover:opacity-90 group relative",
                isInterface && "my-1"
              ]}
              style={`width: ${width}%; height: ${isInterface ? '6px' : '18px'}; background: ${band.color}; opacity: 0.8;`}
              title={`${band.id}: ${band.name} — ${band.description}`}
            >
              <span class:list={[
                "absolute inset-0 flex items-center justify-between px-2 text-[9px] font-mono text-white/80 opacity-0 group-hover:opacity-100 transition-opacity",
                isInterface && "hidden"
              ]}>
                <span>{band.id}</span>
                <span class="hidden sm:inline">{band.name}</span>
              </span>
            </a>
          );
        })}
      </div>

      <div class="flex items-center justify-center gap-6 text-[10px] text-[var(--color-text-faint)]">
        <span class="flex items-center gap-1.5">
          <span class="w-2 h-2 rounded-sm" style="background: #166534;"></span>
          Neural (N7–N1)
        </span>
        <span class="flex items-center gap-1.5">
          <span class="w-2 h-2 rounded-sm" style="background: #f59e0b;"></span>
          Interface (I0)
        </span>
        <span class="flex items-center gap-1.5">
          <span class="w-2 h-2 rounded-sm" style="background: #3b82f6;"></span>
          Synthetic (S1–S3)
        </span>
      </div>

      <div class="text-center mt-6">
        <a
          href="/lab/hourglass.html"
          class="inline-flex items-center gap-1.5 text-xs font-medium text-[var(--color-accent-primary)] hover:underline"
        >
          Explore full interactive hourglass
          <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- ═══ PIVOT TO TARA ═══ -->
  <section class="py-12 md:py-16" id="tara-pivot">
    <div class="flex items-center gap-4 mb-8">
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
      <h2 class="text-lg sm:text-xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] whitespace-nowrap">
        See the Full Picture
      </h2>
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
    </div>

    <div class="glass rounded-2xl p-6 sm:p-8 max-w-3xl mx-auto reveal">
      <p class="text-sm text-[var(--color-text-muted)] leading-relaxed mb-4">
        This page maps neurorights to brain regions. To see the individual attack techniques behind each threat count —
        with NISS severity scores, therapeutic analogs, and DSM-5-TR psychiatric mappings (research-based, awaiting clinical validation) — explore the TARA Atlas.
      </p>
      <p class="text-sm text-[var(--color-text-muted)] leading-relaxed mb-6">
        TARA is the full registry: {data.stats.totalThreats} techniques scored across four projections (security, clinical,
        diagnostic, governance). Each technique traces through the Neural Impact Chain from physical mechanism
        to clinical outcome. The neurorights shown here are the governance layer that sits on top.
      </p>

      <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
        <a
          href="/TARA/"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium text-white transition-colors"
          style="background: var(--color-accent-primary);"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
          Open TARA Atlas
        </a>
        <span class="text-xs text-[var(--color-text-faint)]">
          View all {data.stats.totalThreats} techniques with full scoring and projections
        </span>
      </div>
    </div>
  </section>

  <!-- ═══ CALL TO ACTION ═══ -->
  <section class="py-12 md:py-20" id="cta">
    <div class="glass rounded-2xl p-8 sm:p-12 max-w-3xl mx-auto text-center reveal">
      <h2 class="text-2xl sm:text-3xl font-bold font-[family-name:var(--font-heading)] mb-4 text-[var(--color-text-primary)]">
        This map is open. Help us stress-test it.
      </h2>
      <p class="text-sm text-[var(--color-text-muted)] mb-8 max-w-lg mx-auto leading-relaxed">
        The QIF framework, TARA registry, and neuroright mappings are all published under Apache 2.0.
        We need clinicians, ethicists, and security researchers to challenge every assumption.
      </p>

      <div class="flex flex-wrap items-center justify-center gap-3">
        <a
          href="/whitepaper/"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium text-white transition-colors"
          style="background: var(--color-accent-primary);"
        >
          Read the Whitepaper
        </a>
        <a
          href="/TARA/"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium transition-colors"
          style="background: rgba(0,0,0,0.05); color: var(--color-text-primary);"
        >
          TARA Registry
        </a>
        <a
          href="https://github.com/qinnovates/qinnovate"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium transition-colors"
          style="background: rgba(0,0,0,0.05); color: var(--color-text-primary);"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          GitHub
        </a>
        <a
          href="https://doi.org/10.5281/zenodo.18640105"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium transition-colors"
          style="background: rgba(0,0,0,0.05); color: var(--color-text-primary);"
        >
          Zenodo Preprint
        </a>
      </div>
    </div>
  </section>

</PageLayout>

<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
