---
import PageLayout from '../layouts/PageLayout.astro';
import BrainVisualization from '../components/brain/BrainVisualization';
import NeurorightCards from '../components/neurogovernance/NeurorightCards';
import { getNeurogovernanceData } from '../lib/neurogovernance-data';
import { getBrainViewData } from '../lib/brain-view-data';
import { HOURGLASS_BANDS, HOURGLASS_WIDTHS } from '../lib/qif-constants';
import { GOVERNING_BODIES, FRAMEWORK_LESSONS, ENGAGEMENT_COLORS, ENGAGEMENT_LABELS } from '../data/convergence-data';
import type { Domain } from '../data/convergence-data';

const data = getNeurogovernanceData();
const brainViews = getBrainViewData();

const breadcrumbs = [
  { label: 'Neurogovernance' },
];
---

<PageLayout
  title="Neurogovernance — Your Brain Has Rights"
  description="An interactive map of 5 neurorights, 102 BCI attack techniques, and the brain regions they protect. The first framework to quantify what neural security means for patients."
  breadcrumbs={breadcrumbs}
  wide
>

  <!-- ═══ HERO ═══ -->
  <section class="py-12 md:py-20">
    <div class="text-center max-w-3xl mx-auto mb-12">
      <p class="text-xs font-medium tracking-[0.2em] uppercase mb-4 text-[var(--color-text-faint)]">
        Neurogovernance Map
      </p>
      <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold font-[family-name:var(--font-heading)] tracking-tight mb-6 leading-[1.15]">
        <span class="text-[var(--color-text-primary)]">Your Brain Has Rights.</span>
        <br />
        <span class="bg-gradient-to-r from-[var(--color-accent-primary)] via-[var(--color-accent-secondary)] to-[var(--color-accent-tertiary)] bg-clip-text text-transparent">
          Here's How We Protect Them.
        </span>
      </h1>
      <p class="text-base sm:text-lg text-[var(--color-text-muted)] max-w-2xl mx-auto leading-relaxed">
        GRC (Governance, Risk, and Compliance) was retrofitted onto IT security decades after the internet shipped.
        The result: compliance that lags threats. We are building neurogovernance into BCI security from day one.
      </p>
    </div>

    <!-- GRC Pillars -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-4xl mx-auto mb-12">
      <div class="glass rounded-xl p-5 text-center">
        <div class="w-10 h-10 rounded-lg mx-auto mb-3 flex items-center justify-center" style="background: rgba(59,130,246,0.15);">
          <svg class="w-5 h-5 text-[var(--color-accent-primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
          </svg>
        </div>
        <h3 class="text-sm font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-1">Governance</h3>
        <p class="text-xs text-[var(--color-text-muted)] leading-relaxed">
          Neurorights policies, informed consent frameworks, ethics alignment. The rules that define what's allowed before the first electrode touches tissue.
        </p>
      </div>
      <div class="glass rounded-xl p-5 text-center">
        <div class="w-10 h-10 rounded-lg mx-auto mb-3 flex items-center justify-center" style="background: rgba(239,68,68,0.15);">
          <svg class="w-5 h-5 text-[var(--color-status-danger)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
          </svg>
        </div>
        <h3 class="text-sm font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-1">Risk</h3>
        <p class="text-xs text-[var(--color-text-muted)] leading-relaxed">
          {data.stats.totalThreats} threat techniques scored with NISS. Physics-derived severity, DSM-5-TR diagnostic mappings, dual-use risk-benefit analysis.
        </p>
      </div>
      <div class="glass rounded-xl p-5 text-center">
        <div class="w-10 h-10 rounded-lg mx-auto mb-3 flex items-center justify-center" style="background: rgba(139,92,246,0.15);">
          <svg class="w-5 h-5 text-[var(--color-accent-secondary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 019 9v.375M10.125 2.25A3.375 3.375 0 0113.5 5.625v1.5c0 .621.504 1.125 1.125 1.125h1.5a3.375 3.375 0 012.25.845" />
          </svg>
        </div>
        <h3 class="text-sm font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-1">Compliance</h3>
        <p class="text-xs text-[var(--color-text-muted)] leading-relaxed">
          FDORA/FDA crosswalk, NIST SP 800-53 controls, ISO 27001 mapping, UNESCO alignment. Machine-verifiable where possible.
        </p>
      </div>
    </div>

    <!-- GRC Flow + Gap -->
    <div class="glass rounded-2xl p-6 sm:p-8 max-w-4xl mx-auto mb-12 reveal">
      <h3 class="text-base font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-2 text-center">
        How Security GRC Works
      </h3>
      <p class="text-xs text-[var(--color-text-muted)] text-center mb-6">
        This cycle drives IT security. For BCIs, it breaks at step 1: the external forces barely exist.
      </p>

      <!-- Flowchart -->
      <div class="flex flex-col items-center gap-2 max-w-sm mx-auto mb-8">
        <div class="w-full rounded-lg p-3 text-center border border-[var(--color-accent-primary)]/30" style="background: rgba(59,130,246,0.08);">
          <p class="text-xs font-bold text-[var(--color-accent-primary)] mb-0.5">1. External Forces Set Requirements</p>
          <p class="text-[10px] text-[var(--color-text-muted)]">HIPAA, PCI-DSS, SOX, GDPR, NIST CSF, ISO 27001, SOC 2</p>
        </div>
        <svg class="w-4 h-4 text-[var(--color-text-faint)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>
        <div class="w-full rounded-lg p-3 text-center border border-[var(--color-accent-secondary)]/30" style="background: rgba(139,92,246,0.08);">
          <p class="text-xs font-bold text-[var(--color-accent-secondary)] mb-0.5">2. GRC Translates Into Policy</p>
          <p class="text-[10px] text-[var(--color-text-muted)]">Maps requirements to controls, writes policies, maintains risk register</p>
        </div>
        <svg class="w-4 h-4 text-[var(--color-text-faint)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>
        <div class="w-full rounded-lg p-3 text-center border border-green-500/30" style="background: rgba(34,197,94,0.08);">
          <p class="text-xs font-bold text-green-500 mb-0.5">3. Security Engineering Implements</p>
          <p class="text-[10px] text-[var(--color-text-muted)]">Firewalls, encryption, access management, monitoring, detection</p>
        </div>
        <svg class="w-4 h-4 text-[var(--color-text-faint)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>
        <div class="w-full rounded-lg p-3 text-center border border-[var(--color-status-warn)]/30" style="background: rgba(245,158,11,0.08);">
          <p class="text-xs font-bold text-[var(--color-status-warn)] mb-0.5">4. GRC Audits Adherence</p>
          <p class="text-[10px] text-[var(--color-text-muted)]">Evidence collection, gap analysis, audit prep, remediation tracking</p>
        </div>
        <div class="flex items-center gap-2 mt-1">
          <svg class="w-3 h-3 text-[var(--color-text-faint)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" /></svg>
          <span class="text-[10px] text-[var(--color-text-faint)] italic">loops back to step 1</span>
        </div>
      </div>

      <!-- Delta table -->
      <h3 class="text-sm font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-3 text-center">
        The BCI Security Delta
      </h3>
      <div class="overflow-x-auto">
        <table class="w-full text-xs">
          <thead>
            <tr class="border-b border-[var(--color-border)]">
              <th class="text-left py-2 px-2 text-[var(--color-text-muted)] font-medium">GRC Step</th>
              <th class="text-left py-2 px-2 text-[var(--color-text-muted)] font-medium">IT Security (Mature)</th>
              <th class="text-left py-2 px-2 text-[var(--color-text-muted)] font-medium">BCI Security (Today)</th>
              <th class="text-left py-2 px-2 text-[var(--color-status-danger)] font-medium">Gap</th>
            </tr>
          </thead>
          <tbody class="text-[var(--color-text-muted)]">
            <tr class="border-b border-[var(--color-border)]/30">
              <td class="py-2 px-2 font-medium text-[var(--color-text-primary)]">Requirements</td>
              <td class="py-2 px-2">HIPAA, PCI-DSS, GDPR, FedRAMP</td>
              <td class="py-2 px-2">FDA 510(k) covers safety, not neural cybersecurity. FDORA Sec. 3305 is closest.</td>
              <td class="py-2 px-2 text-[var(--color-status-danger)]">No neural-specific regulations</td>
            </tr>
            <tr class="border-b border-[var(--color-border)]/30">
              <td class="py-2 px-2 font-medium text-[var(--color-text-primary)]">Policy</td>
              <td class="py-2 px-2">NIST CSF, ISO 27001, CIS Controls</td>
              <td class="py-2 px-2">Generic controls exist but lack neural metrics (tissue damage, cognitive integrity)</td>
              <td class="py-2 px-2 text-[var(--color-status-danger)]">No neural-aware frameworks</td>
            </tr>
            <tr class="border-b border-[var(--color-border)]/30">
              <td class="py-2 px-2 font-medium text-[var(--color-text-primary)]">Implementation</td>
              <td class="py-2 px-2">Firewalls, IDS/IPS, SIEM, IAM</td>
              <td class="py-2 px-2">No commercial BCI security tools, neural firewalls, or BCI encryption protocols</td>
              <td class="py-2 px-2 text-[var(--color-status-danger)]">Everything built from scratch</td>
            </tr>
            <tr>
              <td class="py-2 px-2 font-medium text-[var(--color-text-primary)]">Audit</td>
              <td class="py-2 px-2">SOC 2 auditors, PCI QSAs, HIPAA assessors</td>
              <td class="py-2 px-2">No BCI security auditors, no certifications, no audit criteria</td>
              <td class="py-2 px-2 text-[var(--color-status-danger)]">No one to audit against nothing</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="text-center mt-5">
        <a
          href="https://github.com/qinnovates/qinnovate/blob/main/governance/NEUROSECURITY-GRC.md"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1.5 text-xs font-medium text-[var(--color-accent-primary)] hover:underline"
        >
          Full GRC gap derivation with framework-by-framework analysis
          <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        </a>
      </div>
    </div>

    <!-- ═══ VENN DIAGRAM: Three Regulatory Domains ═══ -->
    <div class="glass rounded-2xl p-6 sm:p-8 max-w-4xl mx-auto mb-12 reveal">
      <h3 class="text-base font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-2 text-center">
        Three Domains, One Gap
      </h3>
      <p class="text-xs text-[var(--color-text-muted)] text-center mb-6 max-w-xl mx-auto">
        BCI security sits at the intersection of three regulatory domains that do not talk to each other.
        Each covers part of the problem. None covers the center.
      </p>

      <!-- SVG Venn Diagram -->
      <div class="flex justify-center mb-6">
        <svg viewBox="0 0 480 360" class="w-full max-w-lg" role="img" aria-label="Venn diagram showing three overlapping regulatory domains for BCI security">
          <!-- Domain circles -->
          <circle cx="200" cy="150" r="120" fill="rgba(59,130,246,0.08)" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" />
          <circle cx="280" cy="150" r="120" fill="rgba(239,68,68,0.08)" stroke="rgba(239,68,68,0.4)" stroke-width="1.5" />
          <circle cx="240" cy="230" r="120" fill="rgba(139,92,246,0.08)" stroke="rgba(139,92,246,0.4)" stroke-width="1.5" />

          <!-- Domain labels (outside) -->
          <text x="120" y="70" text-anchor="middle" fill="rgba(59,130,246,0.9)" font-size="11" font-weight="bold">Medical Device</text>
          <text x="120" y="83" text-anchor="middle" fill="rgba(59,130,246,0.7)" font-size="9">FDA, FDORA, EU MDR</text>

          <text x="360" y="70" text-anchor="middle" fill="rgba(239,68,68,0.9)" font-size="11" font-weight="bold">Privacy &amp; Neurorights</text>
          <text x="360" y="83" text-anchor="middle" fill="rgba(239,68,68,0.7)" font-size="9">HIPAA, State Laws, Chile</text>

          <text x="240" y="345" text-anchor="middle" fill="rgba(139,92,246,0.9)" font-size="11" font-weight="bold">IT Security Frameworks</text>
          <text x="240" y="358" text-anchor="middle" fill="rgba(139,92,246,0.7)" font-size="9">NIST, ISO, IEC 62443</text>

          <!-- Unique domain content -->
          <text x="155" y="140" text-anchor="middle" fill="currentColor" font-size="8" opacity="0.5">Device safety</text>
          <text x="155" y="152" text-anchor="middle" fill="currentColor" font-size="8" opacity="0.5">Biocompatibility</text>

          <text x="325" y="140" text-anchor="middle" fill="currentColor" font-size="8" opacity="0.5">Consent</text>
          <text x="325" y="152" text-anchor="middle" fill="currentColor" font-size="8" opacity="0.5">Data rights</text>

          <text x="240" y="275" text-anchor="middle" fill="currentColor" font-size="8" opacity="0.5">Controls</text>
          <text x="240" y="287" text-anchor="middle" fill="currentColor" font-size="8" opacity="0.5">Audit</text>

          <!-- Pairwise overlaps -->
          <text x="240" y="120" text-anchor="middle" fill="currentColor" font-size="7" opacity="0.4">FDORA Sec. 3305</text>
          <text x="240" y="130" text-anchor="middle" fill="currentColor" font-size="7" opacity="0.4">(patching only)</text>

          <text x="190" y="215" text-anchor="middle" fill="currentColor" font-size="7" opacity="0.4">IEC 62443</text>
          <text x="190" y="225" text-anchor="middle" fill="currentColor" font-size="7" opacity="0.4">(OT parallel)</text>

          <text x="295" y="215" text-anchor="middle" fill="currentColor" font-size="7" opacity="0.4">HIPAA Security</text>
          <text x="295" y="225" text-anchor="middle" fill="currentColor" font-size="7" opacity="0.4">(covered entities)</text>

          <!-- CENTER: The Gap -->
          <circle cx="240" cy="175" r="28" fill="rgba(245,158,11,0.15)" stroke="rgba(245,158,11,0.6)" stroke-width="2" stroke-dasharray="4 2" />
          <text x="240" y="172" text-anchor="middle" fill="rgba(245,158,11,1)" font-size="9" font-weight="bold">THE GAP</text>
          <text x="240" y="183" text-anchor="middle" fill="rgba(245,158,11,0.8)" font-size="7">No framework</text>
          <text x="240" y="192" text-anchor="middle" fill="rgba(245,158,11,0.8)" font-size="7">covers all three</text>
        </svg>
      </div>

      <p class="text-[10px] text-[var(--color-text-faint)] text-center max-w-lg mx-auto">
        A BCI manufacturer can be FDA-cleared, HIPAA-compliant, and ISO 27001-certified with zero protections
        against adversarial neurostimulation, neural signal tampering, or cognitive state inference.
        That center gap is what neurosecurity GRC fills.
      </p>
    </div>

    <!-- ═══ CONVERGENCE GAP ═══ -->
    <div class="glass rounded-2xl p-6 sm:p-8 max-w-4xl mx-auto mb-12 reveal" id="convergence">
      <h3 class="text-base font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-2 text-center">
        The Convergence Gap
      </h3>
      <p class="text-xs text-[var(--color-text-muted)] text-center mb-6 max-w-xl mx-auto">
        25 organizations mapped across security and neuroethics. Color-coded by how much
        each engages with the other domain. The pattern: deep expertise on one side, blind spots on the other.
      </p>

      <!-- "No Single Entity" callout -->
      <div class="flex items-center gap-3 rounded-lg p-4 mb-6 border border-[var(--color-status-warn)]/30" style="background: rgba(245,158,11,0.06);">
        <svg class="w-8 h-8 shrink-0 text-[var(--color-status-warn)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
        </svg>
        <p class="text-xs text-[var(--color-text-muted)] leading-relaxed">
          <strong class="text-[var(--color-text-primary)]">No single organization</strong> currently bridges
          neurotechnology security and neuroethics governance. Security frameworks lack neural endpoints.
          Neuroethics frameworks lack technical controls. QIF provides the first integrated framework.
        </p>
      </div>

      <!-- Filter tabs -->
      <div class="flex flex-wrap gap-1.5 mb-4 justify-center" id="convergence-filters">
        <button data-filter="all" class="convergence-filter-btn px-3 py-1 rounded-full text-[10px] font-medium border transition-colors active" style="border-color: var(--color-accent-primary); color: var(--color-accent-primary);">All</button>
        <button data-filter="security" class="convergence-filter-btn px-3 py-1 rounded-full text-[10px] font-medium border transition-colors" style="border-color: var(--color-border); color: var(--color-text-muted);">Security</button>
        <button data-filter="neuroethics" class="convergence-filter-btn px-3 py-1 rounded-full text-[10px] font-medium border transition-colors" style="border-color: var(--color-border); color: var(--color-text-muted);">Neuroethics</button>
        <button data-filter="medical" class="convergence-filter-btn px-3 py-1 rounded-full text-[10px] font-medium border transition-colors" style="border-color: var(--color-border); color: var(--color-text-muted);">Medical</button>
        <button data-filter="policy" class="convergence-filter-btn px-3 py-1 rounded-full text-[10px] font-medium border transition-colors" style="border-color: var(--color-border); color: var(--color-text-muted);">Policy</button>
      </div>

      <!-- Convergence table -->
      <div class="overflow-x-auto">
        <table class="w-full text-xs" id="convergence-table">
          <thead>
            <tr class="border-b border-[var(--color-border)]">
              <th class="text-left py-2 px-2 text-[var(--color-text-muted)] font-medium">Organization</th>
              <th class="text-left py-2 px-2 text-[var(--color-text-muted)] font-medium">Domain</th>
              <th class="text-center py-2 px-2 text-[var(--color-text-muted)] font-medium">Neurotech</th>
              <th class="text-center py-2 px-2 text-[var(--color-text-muted)] font-medium">Security</th>
              <th class="text-center py-2 px-2 text-[var(--color-text-muted)] font-medium">Bridge</th>
            </tr>
          </thead>
          <tbody class="text-[var(--color-text-muted)]">
            {GOVERNING_BODIES.map((body) => (
              <tr class="border-b border-[var(--color-border)]/20 convergence-row hover:bg-[var(--color-bg-secondary)]/30 transition-colors" data-domain={body.domain}>
                <td class="py-2 px-2">
                  <span class="font-medium text-[var(--color-text-primary)]">{body.name}</span>
                </td>
                <td class="py-2 px-2">
                  <span class="inline-block px-1.5 py-0.5 rounded text-[9px] font-medium capitalize" style={`background: ${body.domain === 'security' ? 'rgba(59,130,246,0.1)' : body.domain === 'neuroethics' ? 'rgba(139,92,246,0.1)' : body.domain === 'medical' ? 'rgba(34,197,94,0.1)' : 'rgba(245,158,11,0.1)'}; color: ${body.domain === 'security' ? '#3b82f6' : body.domain === 'neuroethics' ? '#8b5cf6' : body.domain === 'medical' ? '#22c55e' : '#f59e0b'};`}>
                    {body.domain}
                  </span>
                </td>
                <td class="py-2 px-2 text-center">
                  <span class="inline-block w-2 h-2 rounded-full" style={`background: ${ENGAGEMENT_COLORS[body.neurotechEngagement]};`} title={ENGAGEMENT_LABELS[body.neurotechEngagement]}></span>
                  <span class="ml-1 text-[9px]">{ENGAGEMENT_LABELS[body.neurotechEngagement]}</span>
                </td>
                <td class="py-2 px-2 text-center">
                  <span class="inline-block w-2 h-2 rounded-full" style={`background: ${ENGAGEMENT_COLORS[body.securityEngagement]};`} title={ENGAGEMENT_LABELS[body.securityEngagement]}></span>
                  <span class="ml-1 text-[9px]">{ENGAGEMENT_LABELS[body.securityEngagement]}</span>
                </td>
                <td class="py-2 px-2 text-center">
                  <span class={`inline-block px-1.5 py-0.5 rounded text-[9px] font-medium ${body.bridgePotential === 'high' ? 'text-green-400' : body.bridgePotential === 'medium' ? 'text-yellow-400' : 'text-[var(--color-text-faint)]'}`} style={`background: ${body.bridgePotential === 'high' ? 'rgba(34,197,94,0.1)' : body.bridgePotential === 'medium' ? 'rgba(234,179,8,0.1)' : 'rgba(100,100,100,0.1)'};`}>
                    {body.bridgePotential}
                  </span>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <!-- Engagement legend -->
      <div class="flex flex-wrap items-center justify-center gap-3 mt-4 text-[9px] text-[var(--color-text-faint)]">
        {Object.entries(ENGAGEMENT_COLORS).map(([level, color]) => (
          <span class="flex items-center gap-1">
            <span class="w-2 h-2 rounded-full" style={`background: ${color};`}></span>
            {ENGAGEMENT_LABELS[level as keyof typeof ENGAGEMENT_LABELS]}
          </span>
        ))}
      </div>
    </div>

    <!-- ═══ LESSONS LEARNED ═══ -->
    <div class="max-w-4xl mx-auto mb-12 reveal">
      <h3 class="text-base font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-2 text-center">
        Lessons from IT Security Adoption
      </h3>
      <p class="text-xs text-[var(--color-text-muted)] text-center mb-6 max-w-xl mx-auto">
        Four frameworks that achieved industry-wide adoption. Each offers a pattern neurosecurity can follow.
      </p>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        {FRAMEWORK_LESSONS.map((lesson) => (
          <div class="glass rounded-xl p-5">
            <h4 class="text-sm font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-2">
              {lesson.framework}
            </h4>
            <p class="text-[11px] text-[var(--color-text-muted)] leading-relaxed mb-3">
              {lesson.lesson}
            </p>
            <div class="border-t border-[var(--color-border)]/30 pt-2">
              <p class="text-[10px] text-[var(--color-accent-primary)] leading-relaxed">
                <strong>BCI parallel:</strong> {lesson.applicability}
              </p>
            </div>
          </div>
        ))}
      </div>

      <div class="text-center mt-5">
        <a
          href="/governance/#neurosecurity_grc_convergence"
          class="inline-flex items-center gap-1.5 text-xs font-medium text-[var(--color-accent-primary)] hover:underline"
        >
          Full convergence strategy with 25 organizations and specific asks
          <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        </a>
      </div>
    </div>

    <!-- ═══ GAP METHODOLOGY: Existing → Gap → Proposal ═══ -->
    <div class="glass rounded-2xl p-6 sm:p-8 max-w-4xl mx-auto mb-12 reveal">
      <h3 class="text-base font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] mb-2 text-center">
        Gap Derivation Methodology
      </h3>
      <p class="text-xs text-[var(--color-text-muted)] text-center mb-6 max-w-xl mx-auto">
        Every component of the QIF framework was derived from the same process:
        take what exists, find what it misses for BCIs, and build the extension.
      </p>

      <!-- Three-column flow cards -->
      <div class="space-y-4">
        <!-- Row 1: Threat Scoring -->
        <div class="grid grid-cols-1 sm:grid-cols-[1fr_auto_1fr_auto_1fr] items-center gap-2 sm:gap-3">
          <div class="rounded-lg p-3 border border-[var(--color-border)]/30 bg-[var(--color-bg-secondary)]/50">
            <p class="text-[10px] font-bold text-[var(--color-text-faint)] uppercase tracking-wider mb-1">Exists</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">CVSS v3.1</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">Industry-standard vulnerability scoring. 8 metrics across base, temporal, and environmental groups.</p>
          </div>
          <svg class="w-4 h-4 text-[var(--color-text-faint)] hidden sm:block shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
          <div class="rounded-lg p-3 border border-[var(--color-status-danger)]/30 bg-[var(--color-status-danger)]/5">
            <p class="text-[10px] font-bold text-[var(--color-status-danger)] uppercase tracking-wider mb-1">Gap</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">No neural dimensions</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">Cannot score biological impact, cognitive integrity loss, consent violation, reversibility, or neuroplasticity risk.</p>
          </div>
          <svg class="w-4 h-4 text-[var(--color-text-faint)] hidden sm:block shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
          <div class="rounded-lg p-3 border border-green-500/30 bg-green-500/5">
            <p class="text-[10px] font-bold text-green-500 uppercase tracking-wider mb-1">Extension</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">NISS</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">5 neural-specific metrics added. Every TARA technique scored on dimensions CVSS cannot express.</p>
          </div>
        </div>

        <!-- Row 2: Threat Taxonomy -->
        <div class="grid grid-cols-1 sm:grid-cols-[1fr_auto_1fr_auto_1fr] items-center gap-2 sm:gap-3">
          <div class="rounded-lg p-3 border border-[var(--color-border)]/30 bg-[var(--color-bg-secondary)]/50">
            <p class="text-[10px] font-bold text-[var(--color-text-faint)] uppercase tracking-wider mb-1">Exists</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">MITRE ATT&CK</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">594 techniques across 14 enterprise tactics. The gold standard for IT threat modeling.</p>
          </div>
          <svg class="w-4 h-4 text-[var(--color-text-faint)] hidden sm:block shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
          <div class="rounded-lg p-3 border border-[var(--color-status-danger)]/30 bg-[var(--color-status-danger)]/5">
            <p class="text-[10px] font-bold text-[var(--color-status-danger)] uppercase tracking-wider mb-1">Gap</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">No BCI tactics or techniques</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">No neural injection, cognitive exfiltration, or neurostimulation manipulation in any MITRE matrix.</p>
          </div>
          <svg class="w-4 h-4 text-[var(--color-text-faint)] hidden sm:block shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
          <div class="rounded-lg p-3 border border-green-500/30 bg-green-500/5">
            <p class="text-[10px] font-bold text-green-500 uppercase tracking-wider mb-1">Extension</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">TARA</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">109 BCI techniques across 15 tactics. MITRE-compatible IDs. Dual-use therapeutic mappings.</p>
          </div>
        </div>

        <!-- Row 3: Security Architecture -->
        <div class="grid grid-cols-1 sm:grid-cols-[1fr_auto_1fr_auto_1fr] items-center gap-2 sm:gap-3">
          <div class="rounded-lg p-3 border border-[var(--color-border)]/30 bg-[var(--color-bg-secondary)]/50">
            <p class="text-[10px] font-bold text-[var(--color-text-faint)] uppercase tracking-wider mb-1">Exists</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">IEC 62443 Zones/Conduits</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">Segments OT systems into security zones. Closest architectural parallel to BCI security.</p>
          </div>
          <svg class="w-4 h-4 text-[var(--color-text-faint)] hidden sm:block shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
          <div class="rounded-lg p-3 border border-[var(--color-status-danger)]/30 bg-[var(--color-status-danger)]/5">
            <p class="text-[10px] font-bold text-[var(--color-status-danger)] uppercase tracking-wider mb-1">Gap</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">No biological endpoints</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">Threat models assume industrial processes. No guidance for when a security incident causes neurological harm.</p>
          </div>
          <svg class="w-4 h-4 text-[var(--color-text-faint)] hidden sm:block shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
          <div class="rounded-lg p-3 border border-green-500/30 bg-green-500/5">
            <p class="text-[10px] font-bold text-green-500 uppercase tracking-wider mb-1">Extension</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">QIF 11-Band Hourglass</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">Neural (N7-N1), Interface (I0), Synthetic (S1-S3). Every band validated. Biology-first security.</p>
          </div>
        </div>

        <!-- Row 4: Wire Protocol -->
        <div class="grid grid-cols-1 sm:grid-cols-[1fr_auto_1fr_auto_1fr] items-center gap-2 sm:gap-3">
          <div class="rounded-lg p-3 border border-[var(--color-border)]/30 bg-[var(--color-bg-secondary)]/50">
            <p class="text-[10px] font-bold text-[var(--color-text-faint)] uppercase tracking-wider mb-1">Exists</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">TLS 1.3</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">Standard transport security. Confidentiality and integrity for data in transit.</p>
          </div>
          <svg class="w-4 h-4 text-[var(--color-text-faint)] hidden sm:block shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
          <div class="rounded-lg p-3 border border-[var(--color-status-danger)]/30 bg-[var(--color-status-danger)]/5">
            <p class="text-[10px] font-bold text-[var(--color-status-danger)] uppercase tracking-wider mb-1">Gap</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">No post-quantum, no neural validation</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">Vulnerable to harvest-now-decrypt-later. Neural data has decades-long sensitivity. No signal authenticity layer.</p>
          </div>
          <svg class="w-4 h-4 text-[var(--color-text-faint)] hidden sm:block shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
          <div class="rounded-lg p-3 border border-green-500/30 bg-green-500/5">
            <p class="text-[10px] font-bold text-green-500 uppercase tracking-wider mb-1">Extension</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">NSP</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">ML-KEM + ML-DSA post-quantum. 6-layer validation stack. Physics-based signal authenticity.</p>
          </div>
        </div>

        <!-- Row 5: Detection -->
        <div class="grid grid-cols-1 sm:grid-cols-[1fr_auto_1fr_auto_1fr] items-center gap-2 sm:gap-3">
          <div class="rounded-lg p-3 border border-[var(--color-border)]/30 bg-[var(--color-bg-secondary)]/50">
            <p class="text-[10px] font-bold text-[var(--color-text-faint)] uppercase tracking-wider mb-1">Exists</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">IDS/IPS (Snort, Suricata)</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">Network intrusion detection. Signature and anomaly-based pattern matching.</p>
          </div>
          <svg class="w-4 h-4 text-[var(--color-text-faint)] hidden sm:block shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
          <div class="rounded-lg p-3 border border-[var(--color-status-danger)]/30 bg-[var(--color-status-danger)]/5">
            <p class="text-[10px] font-bold text-[var(--color-status-danger)] uppercase tracking-wider mb-1">Gap</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">No neural signal monitoring</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">Network IDS cannot detect spectral anomalies, phase variance injection, or coherence degradation in EEG.</p>
          </div>
          <svg class="w-4 h-4 text-[var(--color-text-faint)] hidden sm:block shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
          <div class="rounded-lg p-3 border border-green-500/30 bg-green-500/5">
            <p class="text-[10px] font-bold text-green-500 uppercase tracking-wider mb-1">Extension</p>
            <p class="text-xs font-medium text-[var(--color-text-primary)]">Neurowall</p>
            <p class="text-[10px] text-[var(--color-text-muted)]">Real-time coherence monitoring. Spectral peak detection, CUSUM change-point analysis. 9/9 attacks detected at 30s.</p>
          </div>
        </div>
      </div>

      <div class="text-center mt-6">
        <a
          href="https://github.com/qinnovates/qinnovate/blob/main/governance/NEUROSECURITY-GRC.md"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1.5 text-xs font-medium text-[var(--color-accent-primary)] hover:underline"
        >
          Full gap derivation: 15 frameworks analyzed, 7 unaddressed properties identified
          <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        </a>
      </div>
    </div>

    <!-- Brain SVG -->
    <div class="glass rounded-2xl p-6 sm:p-8 max-w-4xl mx-auto reveal">
      <BrainVisualization
        client:only="react"
        views={brainViews}
        defaultView="governance"
      />
    </div>
  </section>

  <!-- ═══ NEURORIGHT CARDS ═══ -->
  <section class="py-12 md:py-16" id="rights">
    <div class="flex items-center gap-4 mb-8">
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
      <h2 class="text-lg sm:text-xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] whitespace-nowrap">
        The 5 Neurorights
      </h2>
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
    </div>

    <p class="text-sm text-[var(--color-text-muted)] max-w-2xl mx-auto text-center mb-6">
      Four rights from Ienca &amp; Andorno (2017). One proposed by QIF to fill a genuine gap in the literature.
      Two existing rights extended with engineering-level depth from {data.stats.totalThreats} attack techniques.
    </p>

    <div class="glass rounded-xl p-5 max-w-2xl mx-auto mb-8 text-xs text-[var(--color-text-muted)] leading-relaxed space-y-3">
      <p>
        <strong class="text-[var(--color-text-primary)]">Mental Privacy (MP)</strong> protects against <em>reading</em> your neural data &mdash;
        exfiltration, surveillance, and re-identification across datasets. QIF extends MP with data-lifecycle protections:
        cross-modal re-linking, anonymization failure, and informational disassociation.
      </p>
      <p>
        <strong class="text-[var(--color-text-primary)]">Mental Integrity (MI)</strong> protects against <em>writing</em> into your neural signals,
        injection, implanted thoughts, confusion of agency, and signal dynamics disruption. QIF maps this to the CIA triad:
        MP = Confidentiality (don't read), MI = Integrity (don't write). The LSL CVE demonstrates both: Phase 2 (exfiltrate) = MP violation, Phase 3 (inject) = MI violation.
        QIF extends MI with engineering-level specifications for detecting dynamical retuning attacks.
      </p>
      <p class="text-[10px] text-[var(--color-text-faint)]">
        Click any card below to see the highest-impact threats for each right.
      </p>
    </div>

    <div class="reveal">
      <NeurorightCards client:visible neurorights={data.neurorights} />
    </div>
  </section>

  <!-- ═══ HOURGLASS CONTEXT ═══ -->
  <section class="py-12 md:py-16" id="hourglass">
    <div class="flex items-center gap-4 mb-8">
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
      <h2 class="text-lg sm:text-xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] whitespace-nowrap">
        The Hourglass Model
      </h2>
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
    </div>

    <div class="glass rounded-2xl p-6 sm:p-8 max-w-3xl mx-auto reveal">
      <p class="text-sm text-[var(--color-text-muted)] mb-6 text-center leading-relaxed">
        Each neuroright maps to specific bands in the QIF security model. The hourglass traces
        signals from the brain (N7) through the neural interface (I0) to external systems (S3).
        Every band is an attack surface.
      </p>

      <!-- Flat hourglass preview -->
      <div class="space-y-1 max-w-md mx-auto mb-6">
        {HOURGLASS_BANDS.map((band, i) => {
          const width = HOURGLASS_WIDTHS[i];
          const isInterface = band.zone === 'interface';
          return (
            <a
              href={`/lab/hourglass.html#${band.id}`}
              class:list={[
                "block mx-auto rounded-sm transition-all duration-200 hover:opacity-90 group relative",
                isInterface && "my-1"
              ]}
              style={`width: ${width}%; height: ${isInterface ? '6px' : '18px'}; background: ${band.color}; opacity: 0.8;`}
              title={`${band.id}: ${band.name} — ${band.description}`}
            >
              <span class:list={[
                "absolute inset-0 flex items-center justify-between px-2 text-[9px] font-mono text-white/80 opacity-0 group-hover:opacity-100 transition-opacity",
                isInterface && "hidden"
              ]}>
                <span>{band.id}</span>
                <span class="hidden sm:inline">{band.name}</span>
              </span>
            </a>
          );
        })}
      </div>

      <div class="flex items-center justify-center gap-6 text-[10px] text-[var(--color-text-faint)]">
        <span class="flex items-center gap-1.5">
          <span class="w-2 h-2 rounded-sm" style="background: #166534;"></span>
          Neural (N7–N1)
        </span>
        <span class="flex items-center gap-1.5">
          <span class="w-2 h-2 rounded-sm" style="background: #f59e0b;"></span>
          Interface (I0)
        </span>
        <span class="flex items-center gap-1.5">
          <span class="w-2 h-2 rounded-sm" style="background: #3b82f6;"></span>
          Synthetic (S1–S3)
        </span>
      </div>

      <div class="text-center mt-6">
        <a
          href="/lab/hourglass.html"
          class="inline-flex items-center gap-1.5 text-xs font-medium text-[var(--color-accent-primary)] hover:underline"
        >
          Explore full interactive hourglass
          <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- ═══ PIVOT TO TARA ═══ -->
  <section class="py-12 md:py-16" id="tara-pivot">
    <div class="flex items-center gap-4 mb-8">
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
      <h2 class="text-lg sm:text-xl font-bold font-[family-name:var(--font-heading)] text-[var(--color-text-primary)] whitespace-nowrap">
        See the Full Picture
      </h2>
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
    </div>

    <div class="glass rounded-2xl p-6 sm:p-8 max-w-3xl mx-auto reveal">
      <p class="text-sm text-[var(--color-text-muted)] leading-relaxed mb-4">
        This page maps neurorights to brain regions. To see the individual attack techniques behind each threat count —
        with NISS severity scores, therapeutic analogs, and DSM-5-TR psychiatric mappings — explore the TARA Atlas.
      </p>
      <p class="text-sm text-[var(--color-text-muted)] leading-relaxed mb-6">
        TARA is the full registry: {data.stats.totalThreats} techniques scored across four projections (security, clinical,
        diagnostic, governance). Each technique traces through the Neural Impact Chain from physical mechanism
        to clinical outcome. The neurorights shown here are the governance layer that sits on top.
      </p>

      <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
        <a
          href="/TARA/"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium text-white transition-colors"
          style="background: var(--color-accent-primary);"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
          Open TARA Atlas
        </a>
        <span class="text-xs text-[var(--color-text-faint)]">
          View all {data.stats.totalThreats} techniques with full scoring and projections
        </span>
      </div>
    </div>
  </section>

  <!-- ═══ CALL TO ACTION ═══ -->
  <section class="py-12 md:py-20" id="cta">
    <div class="glass rounded-2xl p-8 sm:p-12 max-w-3xl mx-auto text-center reveal">
      <h2 class="text-2xl sm:text-3xl font-bold font-[family-name:var(--font-heading)] mb-4 text-[var(--color-text-primary)]">
        This map is open. Help us stress-test it.
      </h2>
      <p class="text-sm text-[var(--color-text-muted)] mb-8 max-w-lg mx-auto leading-relaxed">
        The QIF framework, TARA registry, and neuroright mappings are all published under Apache 2.0.
        We need clinicians, ethicists, and security researchers to challenge every assumption.
      </p>

      <div class="flex flex-wrap items-center justify-center gap-3">
        <a
          href="/whitepaper/"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium text-white transition-colors"
          style="background: var(--color-accent-primary);"
        >
          Read the Whitepaper
        </a>
        <a
          href="/TARA/"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium transition-colors"
          style="background: rgba(0,0,0,0.05); color: var(--color-text-primary);"
        >
          TARA Registry
        </a>
        <a
          href="https://github.com/qinnovates/qinnovate"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium transition-colors"
          style="background: rgba(0,0,0,0.05); color: var(--color-text-primary);"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          GitHub
        </a>
        <a
          href="https://doi.org/10.5281/zenodo.18640105"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium transition-colors"
          style="background: rgba(0,0,0,0.05); color: var(--color-text-primary);"
        >
          Zenodo Preprint
        </a>
      </div>
    </div>
  </section>

</PageLayout>

<script>
  function initConvergenceFilters() {
    const btns = document.querySelectorAll('.convergence-filter-btn');
    const rows = document.querySelectorAll('.convergence-row');
    if (!btns.length || !rows.length) return;

    btns.forEach((btn) => {
      btn.addEventListener('click', () => {
        const filter = (btn as HTMLElement).dataset.filter;
        btns.forEach((b) => {
          const el = b as HTMLElement;
          if (b === btn) {
            el.style.borderColor = 'var(--color-accent-primary)';
            el.style.color = 'var(--color-accent-primary)';
          } else {
            el.style.borderColor = 'var(--color-border)';
            el.style.color = 'var(--color-text-muted)';
          }
        });
        rows.forEach((row) => {
          const el = row as HTMLElement;
          if (filter === 'all' || el.dataset.domain === filter) {
            el.style.display = '';
          } else {
            el.style.display = 'none';
          }
        });
      });
    });
  }

  document.addEventListener('astro:page-load', initConvergenceFilters);
  initConvergenceFilters();
</script>

<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
